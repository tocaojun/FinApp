# 股票期权快速开始指南

## 🎯 核心概念

**股票期权**是挂钩股票价格的期权产品：
- **成本** = 行权价格 ÷ 3.5
- **价值** = 标的价格 - 行权价格（看涨期权）

## ✅ 已完成

- ✅ 数据库表和函数已创建
- ✅ 后端服务已更新并重启
- ✅ 前端组件已创建
- ✅ 产品管理页面已集成

## 🚀 快速测试（5分钟）

### 1. 刷新前端页面
```
访问：http://localhost:3001/admin/products
按 Ctrl+Shift+R 强制刷新
```

### 2. 创建股票期权

1. **点击"新增产品"按钮**

2. **填写基础信息**：
   - 产品代码：`000001-C-15.50-20251231`
   - 产品名称：`平安银行看涨期权-行权价15.50-2025年12月`
   - 产品类型：选择 **"股票期权"**
   - 市场：选择 `深圳证券交易所`
   - 币种：`CNY`
   - 风险等级：`HIGH`

3. **填写详情信息**（会自动显示股票期权专用表单）：

   **标的股票信息**：
   - 标的股票：选择 `000001.SZ - 平安银行`
   - 系统会自动填充股票代码和显示当前价格

   **期权基本信息**：
   - 期权类型：`看涨期权（CALL）`
   - 行权价格：`15.50`
   - 到期日：`2025-12-31`

   **成本与价值计算**：
   - 成本除数：`3.5`（默认值）
   - 系统会自动显示：
     - ✅ **计算成本**：15.50 ÷ 3.5 = 4.43 元
     - ✅ **当前价值**：根据标的价格自动计算

   **合约信息**（可选）：
   - 合约规模：`10000`
   - 行权方式：`美式（American）`
   - 结算方式：`实物交割`

   **希腊字母**（可选）：
   - Delta：`0.65`
   - Gamma：`0.05`
   - Theta：`-0.02`
   - Vega：`0.15`
   - Rho：`0.08`

4. **保存**

### 3. 验证功能

✅ **检查列表**：
- 产品列表中显示新创建的股票期权
- 产品类型显示为"股票期权"

✅ **测试编辑**：
- 点击"编辑"按钮
- 所有详情字段应该预填充
- 修改行权价格，成本应该自动重新计算

✅ **测试计算**：
- 修改行权价格为 `20.00`
- 成本应该变为：20.00 ÷ 3.5 = 5.71 元
- 如果标的价格为 16.00，价值应该为 0（因为 16.00 < 20.00）

## 📊 计算示例

### 示例1：盈利的看涨期权
```
标的股票：平安银行（当前价格 20.00 元）
期权类型：CALL（看涨）
行权价格：15.50 元
成本除数：3.5

计算：
成本 = 15.50 ÷ 3.5 = 4.43 元
价值 = MAX(0, 20.00 - 15.50) = 4.50 元
盈亏 = 4.50 - 4.43 = +0.07 元 ✅ 盈利
```

### 示例2：亏损的看涨期权
```
标的股票：平安银行（当前价格 14.00 元）
期权类型：CALL（看涨）
行权价格：15.50 元
成本除数：3.5

计算：
成本 = 15.50 ÷ 3.5 = 4.43 元
价值 = MAX(0, 14.00 - 15.50) = 0 元（价外）
盈亏 = 0 - 4.43 = -4.43 元 ❌ 亏损
```

### 示例3：看跌期权
```
标的股票：平安银行（当前价格 14.00 元）
期权类型：PUT（看跌）
行权价格：15.50 元
成本除数：3.5

计算：
成本 = 15.50 ÷ 3.5 = 4.43 元
价值 = MAX(0, 15.50 - 14.00) = 1.50 元
盈亏 = 1.50 - 4.43 = -2.93 元 ❌ 亏损
```

## 🎨 界面特性

### 自动计算显示
- 输入行权价格后，**成本**会自动计算并显示
- 选择标的股票后，会显示**当前价格**
- 如果有标的价格，**当前价值**会自动计算

### 实时更新
- 修改行权价格 → 成本自动更新
- 修改成本除数 → 成本自动更新
- 修改期权类型 → 价值计算公式自动切换

### 可视化卡片
```
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  当前价格       │  │  计算成本       │  │  当前价值       │
│  ¥ 16.00       │  │  ¥ 4.43        │  │  ¥ 0.50        │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

## 🔍 数据库查询

### 查看所有股票期权
```sql
SELECT * FROM finapp.v_stock_options_full;
```

### 查看计算结果
```sql
SELECT 
    symbol,
    name,
    strike_price,
    calculated_cost,
    underlying_current_price,
    calculated_value,
    (calculated_value - calculated_cost) as profit_loss
FROM finapp.v_stock_options_full;
```

### 查看即将到期的期权
```sql
SELECT 
    symbol,
    name,
    expiration_date,
    days_to_expiration
FROM finapp.v_stock_options_full
WHERE days_to_expiration <= 30
ORDER BY days_to_expiration;
```

## 🐛 故障排查

### 问题1：产品类型列表中没有"股票期权"
**解决**：
```bash
# 检查数据库
psql -U finapp_user -d finapp_test -c "SELECT * FROM finapp.asset_types WHERE code = 'STOCK_OPTION';"

# 如果没有，重新执行迁移
cd backend
psql -U finapp_user -d finapp_test -f migrations/009_stock_option_type/up.sql
```

### 问题2：详情字段不显示
**解决**：
1. 检查浏览器控制台是否有错误
2. 确认前端已刷新（Ctrl+Shift+R）
3. 检查 `formAssetTypeCode` 是否正确设置

### 问题3：成本不自动计算
**解决**：
1. 检查是否传入了 `form` prop
2. 检查 `handleFieldsChange` 是否被调用
3. 查看浏览器控制台错误

### 问题4：标的股票列表为空
**解决**：
```bash
# 确保数据库中有股票数据
psql -U finapp_user -d finapp_test -c "SELECT * FROM finapp.assets WHERE asset_type_id = (SELECT id FROM finapp.asset_types WHERE code = 'STOCK');"
```

## 📝 字段说明

### 必填字段
- ✅ 标的股票
- ✅ 期权类型（CALL/PUT）
- ✅ 行权价格
- ✅ 到期日

### 可选字段
- 合约规模（默认10000）
- 行权方式（默认美式）
- 结算方式（默认实物交割）
- 成本除数（默认3.5）
- 希腊字母（Delta、Gamma等）
- 保证金要求
- 手续费率

## 🎓 术语解释

| 术语 | 说明 |
|------|------|
| **看涨期权（CALL）** | 预期标的价格上涨，有权以行权价买入 |
| **看跌期权（PUT）** | 预期标的价格下跌，有权以行权价卖出 |
| **行权价格** | 期权持有人可以买入或卖出标的的价格 |
| **到期日** | 期权的最后交易日和行权日 |
| **价内期权** | 有内在价值的期权（CALL：标的价>行权价） |
| **价外期权** | 无内在价值的期权（CALL：标的价<行权价） |
| **Delta** | 期权价格对标的价格变化的敏感度 |
| **Gamma** | Delta对标的价格变化的敏感度 |
| **Theta** | 期权价格对时间流逝的敏感度（时间衰减） |
| **Vega** | 期权价格对波动率变化的敏感度 |
| **Rho** | 期权价格对利率变化的敏感度 |

## 📚 相关文档

- `STOCK_OPTION_IMPLEMENTATION.md` - 完整实施文档
- `backend/migrations/009_stock_option_type/up.sql` - 数据库迁移脚本
- `frontend/src/components/asset/details/StockOptionDetailsFields.tsx` - 前端组件

## 🎉 下一步

1. ✅ 测试创建股票期权
2. ✅ 测试编辑功能
3. ✅ 验证计算准确性
4. 📊 创建盈亏分析报表
5. 🔔 添加到期提醒功能
6. 📈 集成实时行情数据

---

**准备就绪！** 现在可以开始使用股票期权功能了！

刷新浏览器页面：http://localhost:3001/admin/products
