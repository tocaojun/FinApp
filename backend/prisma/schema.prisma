generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  email                   String                   @unique @db.VarChar(255)
  username                String?                  @unique @db.VarChar(50)
  passwordHash            String                   @map("password_hash") @db.VarChar(255)
  firstName               String?                  @map("first_name") @db.VarChar(100)
  lastName                String?                  @map("last_name") @db.VarChar(100)
  phone                   String?                  @db.VarChar(20)
  avatarUrl               String?                  @map("avatar_url")
  timezone                String?                  @default("UTC") @db.VarChar(50)
  language                String?                  @default("zh-CN") @db.VarChar(10)
  currencyPreference      String?                  @default("CNY") @map("currency_preference") @db.VarChar(3)
  isActive                Boolean?                 @default(true) @map("is_active")
  isVerified              Boolean?                 @default(false) @map("is_verified")
  emailVerifiedAt         DateTime?                @map("email_verified_at") @db.Timestamptz(6)
  lastLoginAt             DateTime?                @map("last_login_at") @db.Timestamptz(6)
  loginCount              Int?                     @default(0) @map("login_count")
  failedLoginAttempts     Int?                     @default(0) @map("failed_login_attempts")
  lockedUntil             DateTime?                @map("locked_until") @db.Timestamptz(6)
  createdAt               DateTime?                @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime?                @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  auditLogs               AuditLog[]
  emailVerificationTokens EmailVerificationToken[]
  passwordResetTokens     PasswordResetToken[]
  portfolio_tags          portfolio_tags[]
  portfolios              Portfolio[]
  reports                 Report[]
  tag_categories          tag_categories[]
  tags                    tags[]
  transactions            Transaction[]
  assignedRoles           UserRole[]               @relation("AssignedBy")
  userRoles               UserRole[]
  userSessions            UserSession[]

  @@index([createdAt], map: "idx_users_created_at")
  @@index([email], map: "idx_users_email")
  @@index([isActive], map: "idx_users_is_active")
  @@index([lastLoginAt], map: "idx_users_last_login_at")
  @@index([username], map: "idx_users_username")
  @@map("users")
}

model Portfolio {
  id                 String              @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId             String              @map("user_id") @db.Uuid
  name               String              @db.VarChar(100)
  description        String?
  baseCurrency       String              @default("CNY") @map("base_currency") @db.VarChar(3)
  isDefault          Boolean?            @default(false) @map("is_default")
  isActive           Boolean?            @default(true) @map("is_active")
  createdAt          DateTime?           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime?           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  sort_order         Int?                @default(0)
  cashFlows          CashFlow[]
  performanceMetrics PerformanceMetric[]
  portfolioSnapshots PortfolioSnapshot[]
  portfolio_tags     portfolio_tags[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  positions          Position[]
  reports            Report[]
  tradingAccounts    TradingAccount[]
  transactions       Transaction[]

  @@unique([userId, name])
  @@index([isActive], map: "idx_portfolios_is_active")
  @@index([isDefault], map: "idx_portfolios_is_default")
  @@index([userId], map: "idx_portfolios_user_id")
  @@index([userId, sort_order], map: "idx_portfolios_user_sort")
  @@map("portfolios")
}

model TradingAccount {
  id              String        @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId     String        @map("portfolio_id") @db.Uuid
  name            String        @db.VarChar(100)
  accountType     String        @map("account_type") @db.VarChar(50)
  brokerName      String?       @map("broker_name") @db.VarChar(100)
  accountNumber   String?       @map("account_number") @db.VarChar(100)
  currency        String        @db.VarChar(3)
  initial_balance Decimal?      @default(0) @db.Decimal(20, 8)
  current_balance Decimal?      @default(0) @db.Decimal(20, 8)
  isActive        Boolean?      @default(true) @map("is_active")
  createdAt       DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime?     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  cash_flows      CashFlow[]
  positions       Position[]
  portfolio       Portfolio     @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transactions    Transaction[]

  @@index([accountType], map: "idx_trading_accounts_account_type")
  @@index([isActive], map: "idx_trading_accounts_is_active")
  @@index([portfolioId], map: "idx_trading_accounts_portfolio_id")
  @@map("trading_accounts")
}

model Asset {
  id                                                                    String                  @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  symbol                                                                String                  @db.VarChar(50)
  name                                                                  String                  @db.VarChar(200)
  assetTypeId                                                           String                  @map("asset_type_id") @db.Uuid
  currency                                                              String                  @db.VarChar(3)
  isin                                                                  String?                 @db.VarChar(12)
  cusip                                                                 String?                 @db.VarChar(9)
  sector                                                                String?                 @db.VarChar(100)
  industry                                                              String?                 @db.VarChar(100)
  description                                                           String?
  metadata                                                              Json?
  isActive                                                              Boolean?                @default(true) @map("is_active")
  createdAt                                                             DateTime?               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                                                             DateTime?               @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  risk_level                                                            String?                 @default("MEDIUM") @db.VarChar(20)
  lot_size                                                              Int?                    @default(1)
  tick_size                                                             Decimal?                @default(0.01) @db.Decimal(10, 6)
  listing_date                                                          DateTime?               @db.Date
  delisting_date                                                        DateTime?               @db.Date
  tags                                                                  String[]
  created_by                                                            String?                 @db.Uuid
  updated_by                                                            String?                 @db.Uuid
  liquidity_tag                                                         String?                 @db.Uuid
  country_id                                                            String?                 @map("country_id") @db.Uuid
  assetPrices                                                           AssetPrice[]
  assetType                                                             AssetType               @relation(fields: [assetTypeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  country                                                               Country?                @relation(fields: [country_id], references: [id], onUpdate: NoAction)
  liquidity_tags                                                        LiquidityTag?           @relation(fields: [liquidity_tag], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_assets_liquidity_tag")
  bond_details                                                          bond_details?
  cash_flows                                                            CashFlow[]
  fund_details                                                          fund_details?
  futures_details                                                       futures_details?
  optionDetails                                                         OptionDetail[]
  option_details_option_details_underlying_asset_idToassets             OptionDetail[]          @relation("option_details_underlying_asset_idToassets")
  positions                                                             Position[]
  price_sync_errors                                                     price_sync_errors[]
  stock_details                                                         stock_details?
  stock_option_details_stock_option_details_asset_idToassets            stock_option_details?   @relation("stock_option_details_asset_idToassets")
  stock_option_details_stock_option_details_underlying_stock_idToassets stock_option_details[]  @relation("stock_option_details_underlying_stock_idToassets")
  transactions                                                          Transaction[]
  treasury_details                                                      treasury_details?
  wealth_product_details                                                wealth_product_details?

  @@unique([country_id, symbol], map: "assets_country_id_symbol_unique")
  @@index([isActive], map: "idx_assets_active")
  @@index([assetTypeId], map: "idx_assets_asset_type")
  @@index([assetTypeId], map: "idx_assets_asset_type_id")
  @@index([createdAt], map: "idx_assets_created_at")
  @@index([currency], map: "idx_assets_currency")
  @@index([isActive], map: "idx_assets_is_active")
  @@index([country_id], map: "idx_assets_country_id")
  @@index([sector], map: "idx_assets_sector")
  @@index([symbol], map: "idx_assets_symbol")
  @@map("assets")
}

model Position {
  id                  String             @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId         String             @map("portfolio_id") @db.Uuid
  tradingAccountId    String             @map("trading_account_id") @db.Uuid
  assetId             String             @map("asset_id") @db.Uuid
  quantity            Decimal            @default(0) @db.Decimal(20, 8)
  averageCost         Decimal            @default(0) @map("average_cost") @db.Decimal(20, 8)
  totalCost           Decimal            @default(0) @map("total_cost") @db.Decimal(20, 8)
  currency            String             @db.VarChar(3)
  firstPurchaseDate   DateTime?          @map("first_purchase_date") @db.Date
  lastTransactionDate DateTime?          @map("last_transaction_date") @db.Date
  isActive            Boolean?           @default(true) @map("is_active")
  createdAt           DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  positionSnapshots   PositionSnapshot[]
  asset               Asset              @relation(fields: [assetId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  portfolio           Portfolio          @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tradingAccount      TradingAccount     @relation(fields: [tradingAccountId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([portfolioId, tradingAccountId, assetId])
  @@index([assetId], map: "idx_positions_asset_id")
  @@index([isActive], map: "idx_positions_is_active")
  @@index([portfolioId], map: "idx_positions_portfolio_id")
  @@index([tradingAccountId], map: "idx_positions_trading_account_id")
  @@map("positions")
}

model Transaction {
  id                       String                     @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId              String                     @map("portfolio_id") @db.Uuid
  tradingAccountId         String                     @map("trading_account_id") @db.Uuid
  assetId                  String                     @map("asset_id") @db.Uuid
  transactionType          String                     @map("transaction_type") @db.VarChar(20)
  quantity                 Decimal                    @db.Decimal(20, 8)
  price                    Decimal?                   @db.Decimal(20, 8)
  totalAmount              Decimal                    @map("total_amount") @db.Decimal(20, 8)
  fees                     Decimal?                   @default(0) @db.Decimal(20, 8)
  taxes                    Decimal?                   @default(0) @db.Decimal(20, 8)
  currency                 String                     @db.VarChar(3)
  exchange_rate            Decimal?                   @default(1) @db.Decimal(20, 8)
  transactionDate          DateTime                   @map("transaction_date") @db.Date
  settlement_date          DateTime?                  @db.Date
  notes                    String?
  tags                     String[]
  liquidity_tag_id         String?                    @db.Uuid
  external_id              String?                    @db.VarChar(100)
  metadata                 Json?
  createdAt                DateTime?                  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                DateTime?                  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  user_id                  String?                    @db.Uuid
  side                     String?                    @db.VarChar(20)
  executed_at              DateTime?                  @db.Timestamptz(6)
  settled_at               DateTime?                  @db.Timestamptz(6)
  status                   String?                    @default("EXECUTED") @db.VarChar(20)
  liquidity_tag            String?                    @db.VarChar(20)
  cash_flows               CashFlow[]
  transaction_tag_mappings transaction_tag_mappings[]
  asset                    Asset                      @relation(fields: [assetId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  liquidity_tags           LiquidityTag?              @relation(fields: [liquidity_tag_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  portfolio                Portfolio                  @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tradingAccount           TradingAccount             @relation(fields: [tradingAccountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                    User?                      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([assetId], map: "idx_transactions_asset_id")
  @@index([executed_at], map: "idx_transactions_executed_at")
  @@index([external_id], map: "idx_transactions_external_id")
  @@index([liquidity_tag], map: "idx_transactions_liquidity_tag")
  @@index([liquidity_tag_id], map: "idx_transactions_liquidity_tag_id")
  @@index([portfolioId], map: "idx_transactions_portfolio_id")
  @@index([side], map: "idx_transactions_side")
  @@index([status], map: "idx_transactions_status")
  @@index([tags], map: "idx_transactions_tags", type: Gin)
  @@index([totalAmount], map: "idx_transactions_total_amount")
  @@index([tradingAccountId], map: "idx_transactions_trading_account_id")
  @@index([transactionDate], map: "idx_transactions_transaction_date")
  @@index([transactionType], map: "idx_transactions_transaction_type")
  @@index([user_id], map: "idx_transactions_user_id")
  @@map("transactions")
}

model AssetType {
  id                String             @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  code              String             @unique @db.VarChar(20)
  name              String             @db.VarChar(100)
  category          String             @db.VarChar(50)
  description       String?
  locationDimension String?            @default("market") @map("location_dimension") @db.VarChar(20) // market|country|global
  isActive          Boolean?           @default(true) @map("is_active")
  createdAt         DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  assets            Asset[]
  price_sync_tasks  price_sync_tasks[]

  @@index([category], map: "idx_asset_types_category")
  @@index([code], map: "idx_asset_types_code")
  @@index([isActive], map: "idx_asset_types_is_active")
  @@index([locationDimension], map: "idx_asset_types_location_dimension")
  @@map("asset_types")
}

model Market {
  id               String             @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  code             String             @unique @db.VarChar(10)
  name             String             @db.VarChar(100)
  country          String             @db.VarChar(3)
  currency         String             @db.VarChar(3)
  timezone         String             @db.VarChar(50)
  trading_hours    Json?
  holidays         Json?
  isActive         Boolean?           @default(true) @map("is_active")
  createdAt        DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  price_sync_tasks price_sync_tasks[]

  @@index([code], map: "idx_markets_code")
  @@index([isActive], map: "idx_markets_is_active")
  @@map("markets")
}

model Role {
  id              String           @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  name            String           @unique @db.VarChar(50)
  description     String?
  isActive        Boolean?         @default(true) @map("is_active")
  createdAt       DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at      DateTime?        @default(now()) @db.Timestamptz(6)
  rolePermissions RolePermission[]
  userRoles       UserRole[]

  @@map("roles")
}

model Permission {
  id              String           @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  name            String           @unique @db.VarChar(100)
  resource        String           @db.VarChar(50)
  action          String           @db.VarChar(50)
  description     String?
  createdAt       DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  rolePermissions RolePermission[]

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  roleId       String     @map("role_id") @db.Uuid
  permissionId String     @map("permission_id") @db.Uuid
  createdAt    DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([roleId, permissionId])
  @@index([permissionId], map: "idx_role_permissions_permission_id")
  @@index([roleId], map: "idx_role_permissions_role_id")
  @@map("role_permissions")
}

model UserRole {
  id             String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId         String    @map("user_id") @db.Uuid
  roleId         String    @map("role_id") @db.Uuid
  assignedBy     String?   @map("assigned_by") @db.Uuid
  assignedAt     DateTime? @default(now()) @map("assigned_at") @db.Timestamptz(6)
  expiresAt      DateTime? @map("expires_at") @db.Timestamptz(6)
  isActive       Boolean?  @default(true) @map("is_active")
  assignedByUser User?     @relation("AssignedBy", fields: [assignedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  role           Role      @relation(fields: [roleId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, roleId])
  @@index([isActive], map: "idx_user_roles_is_active")
  @@index([roleId], map: "idx_user_roles_role_id")
  @@index([userId], map: "idx_user_roles_user_id")
  @@map("user_roles")
}

model UserSession {
  id               String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId           String    @map("user_id") @db.Uuid
  tokenHash        String    @map("token_hash") @db.VarChar(255)
  refreshTokenHash String?   @map("refresh_token_hash") @db.VarChar(255)
  deviceInfo       Json?     @map("device_info")
  ipAddress        String?   @map("ip_address") @db.Inet
  userAgent        String?   @map("user_agent")
  isActive         Boolean?  @default(true) @map("is_active")
  expiresAt        DateTime  @map("expires_at") @db.Timestamptz(6)
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  lastUsedAt       DateTime? @default(now()) @map("last_used_at") @db.Timestamptz(6)
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expiresAt], map: "idx_user_sessions_expires_at")
  @@index([isActive], map: "idx_user_sessions_is_active")
  @@index([tokenHash], map: "idx_user_sessions_token_hash")
  @@index([userId], map: "idx_user_sessions_user_id")
  @@map("user_sessions")
}

model EmailVerificationToken {
  id          String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  token_hash  String    @db.VarChar(255)
  email       String    @db.VarChar(255)
  expiresAt   DateTime  @map("expires_at") @db.Timestamptz(6)
  verified_at DateTime? @db.Timestamptz(6)
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expiresAt], map: "idx_email_verification_tokens_expires_at")
  @@index([token_hash], map: "idx_email_verification_tokens_token_hash")
  @@index([userId], map: "idx_email_verification_tokens_user_id")
  @@map("email_verification_tokens")
}

model PasswordResetToken {
  id         String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  token_hash String    @db.VarChar(255)
  expiresAt  DateTime  @map("expires_at") @db.Timestamptz(6)
  used_at    DateTime? @db.Timestamptz(6)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expiresAt], map: "idx_password_reset_tokens_expires_at")
  @@index([token_hash], map: "idx_password_reset_tokens_token_hash")
  @@index([userId], map: "idx_password_reset_tokens_user_id")
  @@map("password_reset_tokens")
}

model AuditLog {
  id             String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId         String?   @map("user_id") @db.Uuid
  table_name     String    @db.VarChar(100)
  record_id      String    @db.Uuid
  action         String    @db.VarChar(20)
  oldValues      Json?     @map("old_values")
  newValues      Json?     @map("new_values")
  changed_fields String[]
  ipAddress      String?   @map("ip_address") @db.Inet
  userAgent      String?   @map("user_agent")
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user           User?     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([action], map: "idx_audit_logs_action")
  @@index([createdAt], map: "idx_audit_logs_created_at")
  @@index([record_id], map: "idx_audit_logs_record_id")
  @@index([table_name], map: "idx_audit_logs_table_name")
  @@index([userId], map: "idx_audit_logs_user_id")
  @@map("audit_logs")
}

model CashFlow {
  id                 String          @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId        String          @map("portfolio_id") @db.Uuid
  trading_account_id String?         @db.Uuid
  asset_id           String?         @db.Uuid
  flowType           String          @map("flow_type") @db.VarChar(20)
  amount             Decimal         @db.Decimal(20, 8)
  currency           String          @db.VarChar(3)
  flowDate           DateTime        @map("flow_date") @db.Date
  description        String?
  transaction_id     String?         @db.Uuid
  createdAt          DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)
  date               DateTime?       @db.Timestamptz(6)
  category           String?         @db.VarChar(50)
  assets             Asset?          @relation(fields: [asset_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  portfolio          Portfolio       @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  trading_accounts   TradingAccount? @relation(fields: [trading_account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transactions       Transaction?    @relation(fields: [transaction_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([asset_id], map: "idx_cash_flows_asset_id")
  @@index([category], map: "idx_cash_flows_category")
  @@index([date], map: "idx_cash_flows_date")
  @@index([flowDate], map: "idx_cash_flows_flow_date")
  @@index([flowType], map: "idx_cash_flows_flow_type")
  @@index([portfolioId], map: "idx_cash_flows_portfolio_id")
  @@index([trading_account_id], map: "idx_cash_flows_trading_account_id")
  @@index([transaction_id], map: "idx_cash_flows_transaction_id")
  @@map("cash_flows")
}

model AssetPrice {
  id             String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  assetId        String    @map("asset_id") @db.Uuid
  priceDate      DateTime  @map("price_date") @db.Date
  openPrice      Decimal?  @map("open_price") @db.Decimal(20, 8)
  highPrice      Decimal?  @map("high_price") @db.Decimal(20, 8)
  lowPrice       Decimal?  @map("low_price") @db.Decimal(20, 8)
  closePrice     Decimal   @map("close_price") @db.Decimal(20, 8)
  volume         BigInt?
  adjusted_close Decimal?  @db.Decimal(20, 8)
  currency       String    @db.VarChar(3)
  data_source    String?   @db.VarChar(50)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  asset          Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([assetId, priceDate])
  @@index([assetId, priceDate], map: "idx_asset_prices_asset_date")
  @@index([assetId], map: "idx_asset_prices_asset_id")
  @@index([createdAt], map: "idx_asset_prices_created_at")
  @@index([priceDate], map: "idx_asset_prices_date")
  @@index([priceDate], map: "idx_asset_prices_price_date")
  @@map("asset_prices")
}

model ExchangeRate {
  id           String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  fromCurrency String    @map("from_currency") @db.VarChar(3)
  toCurrency   String    @map("to_currency") @db.VarChar(3)
  rateDate     DateTime  @map("rate_date") @db.Date
  rate         Decimal   @db.Decimal(20, 8)
  dataSource   String?   @map("data_source") @db.VarChar(50)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  @@unique([fromCurrency, toCurrency, rateDate])
  @@index([fromCurrency, toCurrency], map: "idx_exchange_rates_currencies")
  @@index([fromCurrency, toCurrency, rateDate], map: "idx_exchange_rates_currencies_date")
  @@index([rateDate], map: "idx_exchange_rates_rate_date")
  @@map("exchange_rates")
}

model Benchmark {
  id              String           @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  name            String           @unique @db.VarChar(100)
  symbol          String           @unique @db.VarChar(20)
  description     String?
  asset_class     String?          @db.VarChar(50)
  currency        String           @db.VarChar(3)
  data_source     String?          @db.VarChar(50)
  isActive        Boolean?         @default(true) @map("is_active")
  createdAt       DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  benchmarkPrices BenchmarkPrice[]

  @@index([isActive], map: "idx_benchmarks_is_active")
  @@index([symbol], map: "idx_benchmarks_symbol")
  @@map("benchmarks")
}

model BenchmarkPrice {
  id          String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  benchmarkId String    @map("benchmark_id") @db.Uuid
  priceDate   DateTime  @map("price_date") @db.Date
  price       Decimal   @db.Decimal(20, 8)
  currency    String    @db.VarChar(3)
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  benchmark   Benchmark @relation(fields: [benchmarkId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([benchmarkId, priceDate])
  @@index([benchmarkId, priceDate], map: "idx_benchmark_prices_benchmark_date")
  @@index([benchmarkId], map: "idx_benchmark_prices_benchmark_id")
  @@index([priceDate], map: "idx_benchmark_prices_price_date")
  @@map("benchmark_prices")
}

model LiquidityTag {
  id           String        @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  name         String        @unique @db.VarChar(50)
  description  String?
  color        String?       @db.VarChar(7)
  sort_order   Int?          @default(0)
  isActive     Boolean?      @default(true) @map("is_active")
  createdAt    DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  assets       Asset[]
  transactions Transaction[]

  @@index([isActive], map: "idx_liquidity_tags_is_active")
  @@index([sort_order], map: "idx_liquidity_tags_sort_order")
  @@map("liquidity_tags")
}

model OptionDetail {
  id                                                String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  assetId                                           String    @map("asset_id") @db.Uuid
  underlying_asset_id                               String?   @db.Uuid
  optionType                                        String    @map("option_type") @db.VarChar(10)
  strikePrice                                       Decimal   @map("strike_price") @db.Decimal(20, 8)
  expirationDate                                    DateTime  @map("expiration_date") @db.Date
  contract_size                                     Int?      @default(100)
  exercise_style                                    String?   @default("american") @db.VarChar(20)
  createdAt                                         DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  asset                                             Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  assets_option_details_underlying_asset_idToassets Asset?    @relation("option_details_underlying_asset_idToassets", fields: [underlying_asset_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([assetId], map: "idx_option_details_asset_id")
  @@index([expirationDate], map: "idx_option_details_expiration_date")
  @@index([underlying_asset_id], map: "idx_option_details_underlying_asset_id")
  @@map("option_details")
}

model PerformanceMetric {
  id            String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId   String    @map("portfolio_id") @db.Uuid
  metric_type   String    @db.VarChar(50)
  period_type   String    @db.VarChar(20)
  period_start  DateTime  @db.Date
  period_end    DateTime  @db.Date
  value         Decimal   @db.Decimal(20, 8)
  currency      String?   @db.VarChar(3)
  metadata      Json?
  calculated_at DateTime? @default(now()) @db.Timestamptz(6)
  portfolio     Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([portfolioId, metric_type, period_type, period_start, period_end])
  @@index([metric_type], map: "idx_performance_metrics_metric_type")
  @@index([period_start, period_end], map: "idx_performance_metrics_period_dates")
  @@index([period_type], map: "idx_performance_metrics_period_type")
  @@index([portfolioId], map: "idx_performance_metrics_portfolio_id")
  @@map("performance_metrics")
}

model PortfolioSnapshot {
  id                   String             @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  portfolioId          String             @map("portfolio_id") @db.Uuid
  snapshotDate         DateTime           @map("snapshot_date") @db.Date
  totalValue           Decimal            @map("total_value") @db.Decimal(20, 8)
  cash_value           Decimal            @default(0) @db.Decimal(20, 8)
  invested_value       Decimal            @default(0) @db.Decimal(20, 8)
  unrealized_gain_loss Decimal            @default(0) @db.Decimal(20, 8)
  realized_gain_loss   Decimal            @default(0) @db.Decimal(20, 8)
  currency             String             @db.VarChar(3)
  metadata             Json?
  createdAt            DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  portfolio            Portfolio          @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  position_snapshots   PositionSnapshot[]

  @@unique([portfolioId, snapshotDate])
  @@index([portfolioId, snapshotDate], map: "idx_portfolio_snapshots_portfolio_date")
  @@index([portfolioId], map: "idx_portfolio_snapshots_portfolio_id")
  @@index([snapshotDate], map: "idx_portfolio_snapshots_snapshot_date")
  @@map("portfolio_snapshots")
}

model PositionSnapshot {
  id                    String            @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  positionId            String            @map("position_id") @db.Uuid
  portfolio_snapshot_id String            @db.Uuid
  snapshotDate          DateTime          @map("snapshot_date") @db.Date
  quantity              Decimal           @db.Decimal(20, 8)
  marketPrice           Decimal?          @map("market_price") @db.Decimal(20, 8)
  marketValue           Decimal?          @map("market_value") @db.Decimal(20, 8)
  average_cost          Decimal           @db.Decimal(20, 8)
  total_cost            Decimal           @db.Decimal(20, 8)
  unrealized_gain_loss  Decimal?          @db.Decimal(20, 8)
  currency              String            @db.VarChar(3)
  createdAt             DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  portfolio_snapshots   PortfolioSnapshot @relation(fields: [portfolio_snapshot_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  position              Position          @relation(fields: [positionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([portfolio_snapshot_id], map: "idx_position_snapshots_portfolio_snapshot_id")
  @@index([positionId], map: "idx_position_snapshots_position_id")
  @@index([snapshotDate], map: "idx_position_snapshots_snapshot_date")
  @@map("position_snapshots")
}

model Report {
  id                String            @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  userId            String            @map("user_id") @db.Uuid
  portfolioId       String?           @map("portfolio_id") @db.Uuid
  name              String            @db.VarChar(200)
  description       String?
  reportType        String            @map("report_type") @db.VarChar(50)
  parameters        Json
  schedule          Json?
  is_scheduled      Boolean?          @default(false)
  isActive          Boolean?          @default(true) @map("is_active")
  last_generated_at DateTime?         @db.Timestamptz(6)
  createdAt         DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  reportExecutions  ReportExecution[]
  portfolio         Portfolio?        @relation(fields: [portfolioId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([isActive], map: "idx_reports_is_active")
  @@index([is_scheduled], map: "idx_reports_is_scheduled")
  @@index([portfolioId], map: "idx_reports_portfolio_id")
  @@index([reportType], map: "idx_reports_report_type")
  @@index([userId], map: "idx_reports_user_id")
  @@map("reports")
}

model ReportExecution {
  id               String    @id @default(dbgenerated("public.uuid_generate_v4()")) @db.Uuid
  reportId         String    @map("report_id") @db.Uuid
  execution_status String    @default("pending") @db.VarChar(20)
  started_at       DateTime? @default(now()) @db.Timestamptz(6)
  completed_at     DateTime? @db.Timestamptz(6)
  file_path        String?
  file_size        BigInt?
  errorMessage     String?   @map("error_message")
  metadata         Json?
  report           Report    @relation(fields: [reportId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([reportId], map: "idx_report_executions_report_id")
  @@index([started_at], map: "idx_report_executions_started_at")
  @@index([execution_status], map: "idx_report_executions_status")
  @@map("report_executions")
}

model portfolio_tags {
  id           Int       @id @default(autoincrement())
  portfolio_id String    @db.Uuid
  tag_id       Int
  created_by   String    @db.Uuid
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  users        User      @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction)
  portfolios   Portfolio @relation(fields: [portfolio_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tags         tags      @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([portfolio_id, tag_id])
}

model tag_categories {
  id                   Int              @id @default(autoincrement())
  name                 String           @db.VarChar(100)
  description          String?
  color                String?          @default("#52c41a") @db.VarChar(7)
  icon                 String?          @db.VarChar(50)
  user_id              String           @db.Uuid
  parent_id            Int?
  sort_order           Int?             @default(0)
  is_active            Boolean?         @default(true)
  created_at           DateTime?        @default(now()) @db.Timestamp(6)
  updated_at           DateTime?        @default(now()) @db.Timestamp(6)
  tag_categories       tag_categories?  @relation("tag_categoriesTotag_categories", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_tag_categories tag_categories[] @relation("tag_categoriesTotag_categories")
  users                User             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tags                 tags[]

  @@unique([user_id, name])
}

model tags {
  id                       Int                        @id @default(autoincrement())
  name                     String                     @db.VarChar(100)
  description              String?
  color                    String?                    @default("#1890ff") @db.VarChar(7)
  icon                     String?                    @db.VarChar(50)
  user_id                  String                     @db.Uuid
  category_id              Int?
  is_system                Boolean?                   @default(false)
  is_active                Boolean?                   @default(true)
  usage_count              Int?                       @default(0)
  created_at               DateTime?                  @default(now()) @db.Timestamp(6)
  updated_at               DateTime?                  @default(now()) @db.Timestamp(6)
  portfolio_tags           portfolio_tags[]
  tag_categories           tag_categories?            @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  users                    User                       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transaction_tag_mappings transaction_tag_mappings[]

  @@unique([user_id, name])
}

/// 交易标签映射表：每个交易可以在每个分类中选择一个标签
model transaction_tag_mappings {
  transaction_id String      @db.Uuid
  tag_id         Int
  created_at     DateTime?   @default(now()) @db.Timestamp(6)
  tags           tags        @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transactions   Transaction @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([transaction_id, tag_id])
  @@index([transaction_id], map: "idx_transaction_tag_mappings_transaction_id")
  @@index([tag_id], map: "idx_transaction_tag_mappings_tag_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model price_data_sources {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String             @unique @db.VarChar(100)
  provider           String             @db.VarChar(50)
  api_endpoint       String?            @db.VarChar(500)
  api_key_encrypted  String?
  config             Json?              @default("{}")
  rate_limit         Int?               @default(60)
  timeout_seconds    Int?               @default(30)
  is_active          Boolean?           @default(true)
  last_sync_at       DateTime?          @db.Timestamp(6)
  last_sync_status   String?            @db.VarChar(20)
  last_error_message String?
  created_at         DateTime?          @default(now()) @db.Timestamp(6)
  updated_at         DateTime?          @default(now()) @db.Timestamp(6)
  created_by         String?            @db.Uuid
  updated_by         String?            @db.Uuid
  price_sync_logs    price_sync_logs[]
  price_sync_tasks   price_sync_tasks[]

  @@index([is_active], map: "idx_price_data_sources_active")
  @@index([provider], map: "idx_price_data_sources_provider")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model price_sync_errors {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  log_id          String          @db.Uuid
  asset_id        String?         @db.Uuid
  asset_symbol    String?         @db.VarChar(50)
  error_type      String?         @db.VarChar(50)
  error_message   String
  error_details   Json?
  occurred_at     DateTime?       @default(now()) @db.Timestamp(6)
  assets          Asset?          @relation(fields: [asset_id], references: [id], onUpdate: NoAction)
  price_sync_logs price_sync_logs @relation(fields: [log_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_price_sync_errors_asset")
  @@index([log_id], map: "idx_price_sync_errors_log")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model price_sync_logs {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id            String?             @db.Uuid
  data_source_id     String?             @db.Uuid
  started_at         DateTime            @default(now()) @db.Timestamp(6)
  completed_at       DateTime?           @db.Timestamp(6)
  status             String              @default("running") @db.VarChar(20)
  total_assets       Int?                @default(0)
  total_records      Int?                @default(0)
  success_count      Int?                @default(0)
  failed_count       Int?                @default(0)
  skipped_count      Int?                @default(0)
  result_summary     Json?
  error_message      String?
  price_sync_errors  price_sync_errors[]
  price_data_sources price_data_sources? @relation(fields: [data_source_id], references: [id], onUpdate: NoAction)
  price_sync_tasks   price_sync_tasks?   @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([started_at(sort: Desc)], map: "idx_price_sync_logs_started")
  @@index([status], map: "idx_price_sync_logs_status")
  @@index([task_id], map: "idx_price_sync_logs_task")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model price_sync_tasks {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String             @db.VarChar(100)
  description        String?
  data_source_id     String             @db.Uuid
  asset_type_id      String?            @db.Uuid
  asset_ids          String[]           @db.Uuid
  schedule_type      String             @default("manual") @db.VarChar(20)
  cron_expression    String?            @db.VarChar(100)
  interval_minutes   Int?
  sync_days_back     Int?               @default(1)
  overwrite_existing Boolean?           @default(false)
  is_active          Boolean?           @default(true)
  last_run_at        DateTime?          @db.Timestamp(6)
  next_run_at        DateTime?          @db.Timestamp(6)
  last_run_status    String?            @db.VarChar(20)
  last_run_result    Json?
  created_at         DateTime?          @default(now()) @db.Timestamp(6)
  updated_at         DateTime?          @default(now()) @db.Timestamp(6)
  created_by         String?            @db.Uuid
  updated_by         String?            @db.Uuid
  price_sync_logs    price_sync_logs[]
  asset_types        AssetType?         @relation(fields: [asset_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  price_data_sources price_data_sources @relation(fields: [data_source_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Market             Market?            @relation(fields: [marketId], references: [id])
  marketId           String?            @db.Uuid

  @@index([is_active], map: "idx_price_sync_tasks_active")
  @@index([data_source_id], map: "idx_price_sync_tasks_data_source")
  @@index([schedule_type, is_active], map: "idx_price_sync_tasks_schedule")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model bond_details {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id          String    @unique @db.Uuid
  bond_type         String    @db.VarChar(50)
  credit_rating     String?   @db.VarChar(10)
  face_value        Decimal   @db.Decimal(20, 2)
  coupon_rate       Decimal   @db.Decimal(5, 2)
  coupon_frequency  String?   @db.VarChar(20)
  issue_date        DateTime  @db.Date
  maturity_date     DateTime  @db.Date
  years_to_maturity Decimal?  @db.Decimal(5, 2)
  yield_to_maturity Decimal?  @db.Decimal(5, 2)
  current_yield     Decimal?  @db.Decimal(5, 2)
  issuer            String?   @db.VarChar(200)
  issue_price       Decimal?  @db.Decimal(20, 2)
  issue_size        Decimal?  @db.Decimal(20, 2)
  callable          Boolean?  @default(false)
  call_date         DateTime? @db.Date
  call_price        Decimal?  @db.Decimal(20, 2)
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  updated_at        DateTime? @default(now()) @db.Timestamptz(6)
  assets            Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_bond_details_asset")
  @@index([maturity_date], map: "idx_bond_details_maturity")
  @@index([bond_type], map: "idx_bond_details_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model fund_details {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id         String    @unique @db.Uuid
  fund_type        String    @db.VarChar(50)
  fund_category    String?   @db.VarChar(50)
  management_fee   Decimal?  @db.Decimal(5, 2)
  custodian_fee    Decimal?  @db.Decimal(5, 2)
  subscription_fee Decimal?  @db.Decimal(5, 2)
  redemption_fee   Decimal?  @db.Decimal(5, 2)
  nav              Decimal?  @db.Decimal(20, 4)
  nav_date         DateTime? @db.Date
  accumulated_nav  Decimal?  @db.Decimal(20, 4)
  fund_size        Decimal?  @db.Decimal(20, 2)
  inception_date   DateTime? @db.Date
  fund_manager     String?   @db.VarChar(200)
  fund_company     String?   @db.VarChar(200)
  min_investment   Decimal?  @db.Decimal(20, 2)
  min_redemption   Decimal?  @db.Decimal(20, 2)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  assets           Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_fund_details_asset")
  @@index([fund_type], map: "idx_fund_details_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model futures_details {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id           String    @unique @db.Uuid
  futures_type       String    @db.VarChar(50)
  underlying_asset   String?   @db.VarChar(200)
  contract_month     String    @db.VarChar(10)
  contract_size      Decimal?  @db.Decimal(20, 4)
  tick_size          Decimal?  @db.Decimal(20, 8)
  tick_value         Decimal?  @db.Decimal(20, 2)
  trading_hours      String?   @db.VarChar(100)
  last_trading_date  DateTime? @db.Date
  delivery_date      DateTime? @db.Date
  delivery_method    String?   @db.VarChar(50)
  initial_margin     Decimal?  @db.Decimal(20, 2)
  maintenance_margin Decimal?  @db.Decimal(20, 2)
  margin_rate        Decimal?  @db.Decimal(5, 2)
  position_limit     Int?
  daily_price_limit  Decimal?  @db.Decimal(5, 2)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  assets             Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_futures_details_asset")
  @@index([contract_month], map: "idx_futures_details_month")
  @@index([futures_type], map: "idx_futures_details_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model stock_details {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id           String    @unique @db.Uuid
  sector             String?   @db.VarChar(100)
  industry           String?   @db.VarChar(100)
  market_cap         Decimal?  @db.Decimal(20, 2)
  shares_outstanding BigInt?
  pe_ratio           Decimal?  @db.Decimal(10, 2)
  pb_ratio           Decimal?  @db.Decimal(10, 2)
  dividend_yield     Decimal?  @db.Decimal(5, 2)
  company_website    String?   @db.VarChar(200)
  headquarters       String?   @db.VarChar(200)
  founded_year       Int?
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  assets             Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_stock_details_asset")
  @@index([industry], map: "idx_stock_details_industry")
  @@index([sector], map: "idx_stock_details_sector")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model stock_option_details {
  id                                                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id                                                String    @unique @db.Uuid
  underlying_stock_id                                     String?   @db.Uuid
  underlying_stock_symbol                                 String?   @db.VarChar(50)
  underlying_stock_name                                   String?   @db.VarChar(200)
  option_type                                             String    @db.VarChar(10)
  strike_price                                            Decimal   @db.Decimal(20, 8)
  expiration_date                                         DateTime  @db.Date
  contract_size                                           Int?      @default(100)
  exercise_style                                          String?   @default("AMERICAN") @db.VarChar(20)
  settlement_type                                         String?   @default("PHYSICAL") @db.VarChar(20)
  multiplier                                              Decimal?  @default(1.0) @db.Decimal(10, 4)
  trading_unit                                            String?   @default("手") @db.VarChar(20)
  min_price_change                                        Decimal?  @db.Decimal(20, 8)
  margin_requirement                                      Decimal?  @db.Decimal(20, 2)
  commission_rate                                         Decimal?  @db.Decimal(5, 4)
  delta                                                   Decimal?  @db.Decimal(10, 6)
  gamma                                                   Decimal?  @db.Decimal(10, 6)
  theta                                                   Decimal?  @db.Decimal(10, 6)
  vega                                                    Decimal?  @db.Decimal(10, 6)
  rho                                                     Decimal?  @db.Decimal(10, 6)
  implied_volatility                                      Decimal?  @db.Decimal(10, 6)
  historical_volatility                                   Decimal?  @db.Decimal(10, 6)
  premium_currency                                        String?   @default("CNY") @db.VarChar(10)
  intrinsic_value                                         Decimal?  @db.Decimal(20, 8)
  time_value                                              Decimal?  @db.Decimal(20, 8)
  cost_divisor                                            Decimal?  @default(3.5) @db.Decimal(10, 2)
  notes                                                   String?
  created_at                                              DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                              DateTime? @default(now()) @db.Timestamptz(6)
  assets_stock_option_details_asset_idToassets            Asset     @relation("stock_option_details_asset_idToassets", fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  assets_stock_option_details_underlying_stock_idToassets Asset?    @relation("stock_option_details_underlying_stock_idToassets", fields: [underlying_stock_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([asset_id], map: "idx_stock_option_details_asset")
  @@index([expiration_date], map: "idx_stock_option_details_expiration")
  @@index([strike_price], map: "idx_stock_option_details_strike")
  @@index([option_type], map: "idx_stock_option_details_type")
  @@index([underlying_stock_id], map: "idx_stock_option_details_underlying")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model treasury_details {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id           String    @unique @db.Uuid
  treasury_type      String    @db.VarChar(50)
  term_type          String?   @db.VarChar(20)
  face_value         Decimal   @db.Decimal(20, 2)
  coupon_rate        Decimal   @db.Decimal(5, 2)
  coupon_frequency   String?   @db.VarChar(20)
  issue_date         DateTime  @db.Date
  maturity_date      DateTime  @db.Date
  term_years         Int?
  issue_price        Decimal?  @db.Decimal(20, 2)
  issue_number       String?   @db.VarChar(50)
  yield_to_maturity  Decimal?  @db.Decimal(5, 2)
  tradable           Boolean?  @default(true)
  min_holding_period Int?
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  assets             Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_treasury_details_asset")
  @@index([maturity_date], map: "idx_treasury_details_maturity")
  @@index([treasury_type], map: "idx_treasury_details_type")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model wealth_product_details {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  asset_id             String    @unique @db.Uuid
  product_type         String    @db.VarChar(50)
  risk_level           String    @db.VarChar(20)
  expected_return      Decimal?  @db.Decimal(5, 2)
  min_return           Decimal?  @db.Decimal(5, 2)
  max_return           Decimal?  @db.Decimal(5, 2)
  return_type          String?   @db.VarChar(20)
  issue_date           DateTime  @db.Date
  start_date           DateTime  @db.Date
  maturity_date        DateTime  @db.Date
  lock_period          Int?
  min_investment       Decimal?  @db.Decimal(20, 2)
  max_investment       Decimal?  @db.Decimal(20, 2)
  investment_increment Decimal?  @db.Decimal(20, 2)
  issuer               String?   @db.VarChar(200)
  product_code         String?   @db.VarChar(50)
  early_redemption     Boolean?  @default(false)
  redemption_fee       Decimal?  @db.Decimal(5, 2)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)
  assets               Asset     @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([asset_id], map: "idx_wealth_details_asset")
  @@index([risk_level], map: "idx_wealth_details_risk")
  @@index([product_type], map: "idx_wealth_details_type")
}

model Country {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code      String    @unique @db.VarChar(3)
  name      String    @db.VarChar(100)
  currency  String?   @db.VarChar(3)
  timezone  String?   @db.VarChar(50)
  isActive  Boolean?  @default(true) @map("is_active")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)
  assets    Asset[]

  @@index([isActive], map: "idx_countries_is_active")
  @@index([code], map: "idx_countries_code")
  @@map("countries")
}
