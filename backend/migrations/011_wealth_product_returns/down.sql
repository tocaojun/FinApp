-- 财富产品收益追踪迁移回滚脚本\n\n-- ============================================\n-- 1. 删除视图\n-- ============================================\n\nDROP VIEW IF EXISTS finapp.vw_deviation_analysis CASCADE;\nDROP VIEW IF EXISTS finapp.vw_wealth_product_returns CASCADE;\n\n-- ============================================\n-- 2. 删除触发器和函数\n-- ============================================\n\nDROP TRIGGER IF EXISTS wealth_transactions_update_timestamp ON finapp.wealth_product_transactions;\nDROP FUNCTION IF EXISTS finapp.update_wealth_transactions_updated_at();\n\n-- ============================================\n-- 3. 删除表\n-- ============================================\n\nDROP TABLE IF EXISTS finapp.wealth_product_nav_history CASCADE;\nDROP TABLE IF EXISTS finapp.wealth_product_transactions CASCADE;\n\n-- ============================================\n-- 4. 删除扩展的列\n-- ============================================\n\nALTER TABLE finapp.wealth_product_details\nDROP COLUMN IF EXISTS product_subtype CASCADE,\nDROP COLUMN IF EXISTS nav_currency CASCADE,\nDROP COLUMN IF EXISTS settlement_method CASCADE,\nDROP COLUMN IF EXISTS dividend_frequency CASCADE,\nDROP COLUMN IF EXISTS total_dividends_received CASCADE,\nDROP COLUMN IF EXISTS dividend_reinvestment CASCADE,\nDROP COLUMN IF EXISTS expected_annual_return CASCADE,\nDROP COLUMN IF EXISTS ytd_return CASCADE,\nDROP COLUMN IF EXISTS cumulative_return CASCADE,\nDROP COLUMN IF EXISTS return_calculation_method CASCADE;\n\n-- ============================================\n-- 完成回滚\n-- ============================================\n\nDO $$\nBEGIN\n  RAISE NOTICE 'Wealth product return tracking migration rolled back successfully';\nEND $$;\n