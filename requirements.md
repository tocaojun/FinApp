# 个人资产管理应用 - 需求规格说明书

## 项目概述

本项目旨在开发一个功能完整的个人资产管理应用，支持多市场、多货币的投资组合管理，提供专业的投资分析和报表功能。

## 1. 多平台支持需求

### 1.1 支持平台
- **Web端**：完整功能的管理界面，基于React + TypeScript + Ant Design
- **移动端APP**：React Native跨平台应用（iOS + Android）
- **微信小程序**：便捷查看和简单操作，支持微信生态集成

### 1.2 平台特性
- **Web端**：完整的投资组合管理、报表分析、管理员功能
- **移动端**：便携式查看、交易录入、实时提醒
- **小程序**：快速查看、简单操作、微信分享功能

## 2. 投资产品管理需求

### 2.1 支持的产品类型
- **股票**：A股、港股、美股、新加坡股票、日股
- **公募基金**：各市场公募基金，支持净值跟踪
- **私募基金**：私募股权、私募证券投资基金
- **债券**：国债、企业债、美国国债等
- **银行理财产品**：各类银行理财产品
- **存款**：定期存款、活期存款
- **股票期权**：各市场股票期权，支持Black-Scholes估值

### 2.2 产品属性管理
- 基础信息：代码、名称、市场、货币
- 特殊属性：期权的行权价、到期日等
- 流动性等级：支持5级流动性分类
- 风险等级：1-5级风险评估

## 3. 多市场支持需求

### 3.1 支持市场
- **中国市场**：A股、中国债券、人民币产品
- **香港市场**：港股、港币产品
- **美国市场**：美股、美债、美元产品
- **新加坡市场**：新加坡股票、新币产品
- **日本市场**：日股、日元产品

### 3.2 市场特性处理
- **时区管理**：各市场独立的交易时间和时区
- **交易规则**：不同市场的交易规则和费用结构
- **节假日**：各市场的节假日日历
- **扩展性**：支持后续新增更多市场

## 4. 技术架构需求

### 4.1 数据库
- **主数据库**：PostgreSQL
- **特性要求**：JSONB支持、时区处理、分区表、全文搜索
- **性能要求**：支持大量历史数据存储和快速查询

### 4.2 数据源集成
#### 已支持的数据源
- **Yahoo Finance** ⭐
  - 覆盖全球主要市场（NYSE、NASDAQ、HKEX、SSE、SZSE、TSE、LSE、FWB等）
  - 支持股票、ETF、指数数据
  - 支持最多10+年的历史数据回溯
  - 无需API密钥，完全免费
  - API地址：https://query1.finance.yahoo.com/v8/finance/chart/

- **EastMoney（东方财富）** ⭐
  - 专注于中国股票市场（A股）
  - 支持SSE（上证）、SZSE（深证）市场
  - 支持最多1000天的历史数据回溯
  - 中文数据源，数据准确可靠
  - API地址：http://push2.eastmoney.com/api/qt/stock/kline/get

- **Tushare**（可选）
  - 专业金融数据库
  - 支持A股、香港股、美股多市场
  - 需要API Key配置（付费）
  - 数据准确度高，适合专业用户

#### 数据源特性
- **自动化同步**：支持定时自动同步价格数据
- **灵活调度**：支持手动、cron表达式、定时间隔三种运行模式
- **错误处理**：完整的错误重试机制和详细的同步日志
- **市场适配**：自动适配不同市场的Symbol格式和汇率转换
- **容错机制**：支持多数据源切换和降级使用

### 4.3 本地部署环境
- **macOS环境**：针对macOS系统优化的本地部署
- **Homebrew管理**：使用Homebrew统一管理所有服务依赖
- **本地服务**：PostgreSQL、Redis、InfluxDB、Nginx等本地安装
- **服务管理**：使用launchd进行服务生命周期管理
- **配置管理**：本地配置文件和环境变量管理

### 4.4 多货币处理
- **原始货币保持**：各产品保持其原始市场货币
- **统一计价**：统计时根据汇率表转换为人民币计价
- **汇率管理**：实时汇率更新、历史汇率存储
- **汇率影响分析**：分离投资收益和汇率收益

## 5. 核心业务功能需求

### 5.1 净值更新系统
- **每日更新**：公募基金净值（T+1日更新）、股票价格（日终更新）
- **定期更新**：私募基金（月度/季度更新）
- **手动录入**：支持管理员手动更新净值
- **数据校验**：异常净值检测和人工审核
- **估值方法**：支持多种估值方法（市价、成本、公允价值）

### 5.2 交易管理
- **交易类型**：买入、卖出、分红、拆股、期权行权等
- **交易账户标签**：用户可自定义交易账户名称
- **流动性标签**：5级流动性标签（即时、高、中、低、非流动）
- **费用管理**：手续费、印花税、管理费等
- **批量导入**：支持Excel等格式批量导入交易记录
- **交易审核**：重要交易的审核流程

### 5.3 持仓管理
- **实时持仓**：当前持仓数量、市值、权重
- **成本计算**：平均成本、总成本、移动平均成本
- **盈亏分析**：已实现盈亏、未实现盈亏、总盈亏
- **多货币显示**：原币种/人民币/双币种显示模式
- **持仓分析**：按市场、行业、货币等维度分析

## 6. 分析和报表功能需求

### 6.1 IRR计算
- **单资产IRR**：计算单个投资的内部收益率
- **组合IRR**：整个投资组合的IRR
- **分类IRR**：按市场、行业、资产类型的IRR
- **时间段IRR**：日、周、月、季、年IRR
- **滚动IRR**：滚动时间窗口的IRR趋势
- **基准比较**：与市场基准的IRR比较

### 6.2 季度报表
- **季度末净值快照**：每季度末的完整净值记录
- **季度间比较**：季度间的变化分析和趋势
- **资产配置分析**：按市场、货币、行业、流动性分布
- **绩效指标**：收益率、夏普比率、最大回撤等
- **风险指标**：波动率、VaR、压力测试结果

### 6.3 流动性管理
- **流动性分层**：按变现时间分为5个等级
- **流动性分析**：流动性分布、充足性分析
- **变现策略**：智能变现计划和成本分析
- **流动性预警**：流动性不足或过剩的预警
- **压力测试**：不同情况下的流动性需求测试

### 6.4 风险管理
- **市场风险**：Beta、相关性分析
- **信用风险**：债券信用评级跟踪
- **流动性风险**：流动性风险评估
- **集中度风险**：持仓集中度分析
- **汇率风险**：外汇敞口和汇率敏感性

## 7. 管理员功能需求

### 7.1 投资产品管理
- **产品CRUD**：创建、查看、更新、删除投资产品
- **产品分类**：多级分类管理体系
- **批量导入**：产品数据批量导入和更新
- **产品审核**：产品变更的审核流程
- **产品统计**：产品使用情况统计

### 7.2 汇率管理
- **数据源配置**：多个汇率数据源的配置和管理
- **汇率监控**：异常汇率的监控和告警
- **手动汇率**：支持管理员手动设置汇率
- **历史汇率**：汇率历史数据的管理和维护
- **汇率预警**：汇率异常变动的预警机制

### 7.3 权限管理
- **角色管理**：超级管理员、管理员、普通用户
- **权限控制**：模块级、功能级的细粒度权限控制
- **用户管理**：用户账户的创建、管理和角色分配
- **操作审计**：完整的操作日志记录和审计
- **会话管理**：用户会话的管理和安全控制

## 8. 用户体验需求

### 8.1 界面设计
- **响应式设计**：适配桌面、平板、手机等各种屏幕
- **多语言支持**：中文、英文等多语言界面
- **主题切换**：支持明暗主题切换
- **个性化设置**：用户偏好设置和界面定制
- **无障碍支持**：符合无障碍设计标准

### 8.2 数据可视化
- **图表展示**：收益趋势图、资产配置饼图、K线图等
- **交互式图表**：支持缩放、筛选、钻取等交互
- **仪表板**：个性化的数据仪表板
- **报表导出**：PDF、Excel、图片格式导出
- **打印功能**：支持报表的打印输出

### 8.3 通知系统
- **价格提醒**：重要价格变动的实时通知
- **到期提醒**：期权到期、产品到期提醒
- **流动性预警**：流动性风险的预警通知
- **系统通知**：系统维护、更新等通知
- **多渠道通知**：Web、APP、微信、邮件等多渠道

## 9. 安全和合规需求

### 9.1 数据安全
- **数据加密**：敏感数据的加密存储和传输
- **访问控制**：严格的数据访问权限控制
- **数据备份**：定期的数据备份和恢复机制
- **隐私保护**：用户隐私数据的保护和匿名化
- **数据脱敏**：敏感数据的脱敏处理

### 9.2 系统安全
- **身份认证**：多因素身份认证（MFA）
- **会话管理**：安全的会话管理和超时控制
- **API安全**：API访问限制、频率控制、签名验证
- **审计日志**：完整的系统操作审计日志
- **安全监控**：实时的安全威胁监控和响应

### 9.3 合规要求
- **数据保护法规**：符合GDPR、个人信息保护法等
- **金融监管**：符合相关金融监管要求
- **审计要求**：支持外部审计的数据提供
- **合规报告**：定期的合规检查报告

## 10. 性能和扩展性需求

### 10.1 性能要求
- **响应时间**：页面加载时间<3秒，API响应时间<1秒
- **并发用户**：支持1000+并发用户
- **数据处理**：支持百万级交易记录的快速查询
- **实时更新**：价格数据的实时推送延迟<5秒
- **报表生成**：复杂报表生成时间<30秒

### 10.2 扩展性设计
- **微服务架构**：模块化的服务设计，支持独立部署
- **水平扩展**：支持服务器集群的水平扩展
- **插件化架构**：支持新市场、新产品类型的插件式扩展
- **API开放性**：提供标准化的开放API接口
- **第三方集成**：支持第三方数据源和服务的集成

### 10.3 可用性要求
- **系统可用性**：99.9%的系统可用性
- **故障恢复**：故障后5分钟内恢复服务
- **数据一致性**：确保数据的强一致性
- **容灾备份**：支持异地容灾备份
- **监控告警**：完善的系统监控和告警机制

## 11. 部署和运维需求

### 11.1 部署要求
- **本地原生部署**：基于macOS的本地服务部署
- **Homebrew包管理**：使用Homebrew管理服务依赖
- **launchd服务管理**：使用macOS原生服务管理
- **CI/CD**：自动化的持续集成和部署
- **环境隔离**：开发、测试、生产环境的隔离
- **版本管理**：支持灰度发布和版本回滚

### 11.2 运维要求
- **监控体系**：应用性能监控（APM）
- **日志管理**：集中化的日志收集和分析
- **告警机制**：多级告警和通知机制
- **性能调优**：定期的性能分析和优化
- **安全扫描**：定期的安全漏洞扫描

## 12. 项目里程碑

### 12.1 第一阶段（MVP - 3个月）
- 基础用户系统和权限管理
- 股票和基金的基本管理功能
- Web端核心功能实现
- 基础的收益计算和报表

### 12.2 第二阶段（完整功能 - 6个月）
- 所有投资产品类型支持
- 移动端APP和微信小程序
- 完整的IRR计算和分析功能
- 流动性管理系统

### 12.3 第三阶段（优化增强 - 9个月）
- 高级分析和报表功能
- 智能投资建议
- 性能优化和用户体验提升
- 第三方数据源集成

## 13. 风险和约束

### 13.1 技术风险
- 第三方API的稳定性和可用性
- 大量历史数据的存储和查询性能
- 实时数据推送的技术实现复杂性

### 13.2 业务风险
- 金融数据的准确性要求
- 不同市场监管政策的变化
- 用户对数据安全和隐私的高要求

### 13.3 项目约束
- 开发团队规模和技术能力
- 项目预算和时间限制
- 第三方服务的成本控制

---

**文档版本**：v1.0  
**创建日期**：2025年9月8日  
**最后更新**：2025年9月8日  
**文档状态**：待评审