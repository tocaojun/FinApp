# 更新日志 (Changelog)

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [v1.2.0] - 2025-10-26

### 新增功能 (Added)
- ✨ **交易账户完整CRUD操作**
  - 实现交易账户创建功能（前后端完整联调）
  - 新增交易账户删除功能（包含安全检查）
  - 完善交易账户更新功能
  
- ✨ **投资组合排序功能**
  - 支持拖拽排序投资组合
  - 添加 `sortOrder` 字段到数据库
  - 实现排序持久化存储
  
- ✨ **默认投资组合设置**
  - 支持设置默认投资组合
  - 添加 `isDefault` 字段
  - 自动取消其他默认设置

- 🗄️ **数据库迁移**
  - 新增投资组合排序字段迁移脚本
  - 优化数据库查询性能

### 改进 (Improved)
- 🔍 **错误处理优化**
  - 前端API错误信息详细展示
  - 后端添加详细的调试日志
  - 友好的用户错误提示消息
  
- 🔒 **安全性增强**
  - 交易账户删除前检查关联持仓
  - 投资组合所有权严格验证
  - 完善权限控制机制
  
- 📊 **数据验证**
  - 前端数据类型转换优化
  - 后端参数验证增强
  - 确保数值类型正确传递

- 🎨 **用户体验**
  - 改进删除确认对话框（红色危险按钮）
  - 优化投资组合列表显示
  - 添加详细的操作反馈

### 修复 (Fixed)
- 🐛 修复交易账户创建失败问题（数据类型和字段映射错误）
- 🐛 修复删除账户只在前端生效，未真正删除数据库记录的问题
- 🐛 修复错误消息显示不完整的问题
- 🐛 修复数据库schema前缀问题（finapp.）
- 🐛 修复数值字段类型转换问题

### 技术细节 (Technical Details)

#### 后端变更
- `PortfolioController.ts`: 新增 `deleteTradingAccount` 方法
- `PortfolioService.ts`: 
  - 实现完整的交易账户删除逻辑
  - 添加详细的验证和日志
  - 优化数据类型处理
- `portfolios.ts`: 新增删除交易账户路由
- `portfolio.ts`: 扩展类型定义（sortOrder, isDefault）

#### 前端变更
- `AccountsTab.tsx`: 
  - 实现真实的删除API调用
  - 优化数据类型转换
  - 改进错误处理
- `PortfolioList.tsx`: 实现拖拽排序功能
- `portfolioService.ts`: 新增 `deleteTradingAccount` 方法
- `api.ts`: 改进错误响应处理

#### 数据库变更
- 新增迁移脚本: `003_portfolio_sorting/001_add_sort_order.sql`
- 添加字段: `portfolios.sort_order`, `portfolios.is_default`

### 文件统计
- 修改文件: 10个
- 新增代码: 692行
- 删除代码: 64行
- 新增迁移脚本: 1个

---

## [v1.1.0] - 2025-10-26

### 新增功能
- 系统配置文档优化
- 交易管理显示修复

---

## [v1.0.0] - 初始版本

### 新增功能
- 用户认证系统
- 投资组合管理
- 交易记录管理
- 产品管理系统
- 用户标签系统
- 汇率管理系统
- 权限管理系统

---

## 版本说明

### 版本号规则
- **主版本号 (Major)**: 不兼容的API修改
- **次版本号 (Minor)**: 向下兼容的功能性新增
- **修订号 (Patch)**: 向下兼容的问题修正

### 标签说明
- ✨ 新功能
- 🐛 Bug修复
- 🔒 安全性
- 📊 数据相关
- 🎨 UI/UX改进
- 🔍 日志/调试
- 🗄️ 数据库
- ⚡ 性能优化
- 📝 文档
