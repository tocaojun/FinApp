<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinApp 页面加载测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>FinApp 页面加载测试</h1>
    
    <div class="status info">
        <strong>说明：</strong>此页面用于测试和诊断FinApp前端页面加载问题
    </div>

    <h2>操作步骤</h2>
    <button onclick="clearStorage()">1. 清除本地存储</button>
    <button onclick="testBackend()">2. 测试后端API</button>
    <button onclick="openApp()">3. 打开FinApp</button>
    
    <h2>测试结果</h2>
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }

        function clearStorage() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                addResult('✅ 本地存储已清除（localStorage 和 sessionStorage）', 'success');
                addResult('提示：如果之前有登录状态，现在已被清除', 'info');
            } catch (error) {
                addResult('❌ 清除存储失败: ' + error.message, 'error');
            }
        }

        async function testBackend() {
            addResult('正在测试后端API...', 'info');
            
            try {
                // 测试健康检查
                const healthResponse = await fetch('http://localhost:8000/health');
                const healthData = await healthResponse.json();
                
                if (healthData.status === 'healthy') {
                    addResult('✅ 后端服务正常运行', 'success');
                    addResult('<pre>' + JSON.stringify(healthData, null, 2) + '</pre>', 'info');
                } else {
                    addResult('⚠️ 后端服务状态异常', 'error');
                }

                // 测试登录API
                const loginResponse = await fetch('http://localhost:8000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'testapi@finapp.com',
                        password: 'testapi123'
                    })
                });
                
                const loginData = await loginResponse.json();
                
                if (loginData.success) {
                    addResult('✅ 登录API正常工作', 'success');
                } else {
                    addResult('⚠️ 登录API返回错误: ' + loginData.message, 'error');
                }

            } catch (error) {
                addResult('❌ 后端API测试失败: ' + error.message, 'error');
                addResult('请确保后端服务正在运行 (http://localhost:8000)', 'info');
            }
        }

        function openApp() {
            addResult('正在打开FinApp...', 'info');
            window.open('http://localhost:3001', '_blank');
            addResult('✅ 已在新标签页打开FinApp', 'success');
            addResult('如果页面仍然卡住，请检查浏览器控制台的错误信息', 'info');
        }

        // 页面加载时自动显示当前状态
        window.onload = function() {
            addResult('测试页面已加载，请按顺序点击上方按钮进行测试', 'info');
            
            // 检查localStorage中是否有旧数据
            const authToken = localStorage.getItem('auth_token');
            const authUser = localStorage.getItem('auth_user');
            
            if (authToken || authUser) {
                addResult('⚠️ 检测到本地存储中有旧的认证数据，建议先清除', 'error');
            } else {
                addResult('✅ 本地存储干净，没有旧的认证数据', 'success');
            }
        };
    </script>
</body>
</html>
