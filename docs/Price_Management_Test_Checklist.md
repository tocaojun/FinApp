# 价格管理功能测试清单

## 测试环境
- 前端服务：http://localhost:3003
- 后端服务：http://localhost:8000
- 测试账户：admin@finapp.com / admin123

## Phase 1 功能测试

### 1. 单产品多日录入测试

#### 1.1 基础功能测试
- [ ] 访问页面：http://localhost:3003/admin/price-management
- [ ] 默认显示"单产品多日录入"标签页
- [ ] 页面正常加载，无控制台错误

#### 1.2 产品搜索功能
- [ ] 在产品选择器中输入少于2个字符，不触发搜索
- [ ] 输入2个或以上字符，触发搜索
- [ ] 搜索结果正确显示（格式：代码 - 名称 (币种)）
- [ ] 选择产品后，产品信息卡片正确显示
- [ ] 产品信息包括：代码、名称、币种

#### 1.3 数据录入功能
- [ ] 默认显示一行空白记录
- [ ] 点击"添加行"按钮，成功添加新行
- [ ] 可以选择不同的日期
- [ ] 可以输入收盘价（必填）
- [ ] 可以输入开盘价（可选）
- [ ] 可以输入最高价（可选）
- [ ] 可以输入最低价（可选）
- [ ] 点击"删除"按钮，成功删除行（至少保留一行）

#### 1.4 数据验证
- [ ] 未选择产品时，点击保存提示"请选择产品"
- [ ] 未填写任何完整记录时，提示"请至少填写一条完整的价格记录"
- [ ] 填写重复日期时，提示"存在重复的日期"
- [ ] 最高价 < 最低价时，提示错误
- [ ] 收盘价不在最高价和最低价之间时，提示错误
- [ ] 开盘价不在最高价和最低价之间时，提示错误

#### 1.5 保存功能
- [ ] 填写有效数据后，点击保存
- [ ] 显示加载状态
- [ ] 保存成功后显示成功消息
- [ ] 数据自动清空
- [ ] 有效记录数统计正确

#### 1.6 清空功能
- [ ] 点击"清空"按钮
- [ ] 显示确认对话框
- [ ] 确认后清空所有数据
- [ ] 产品选择器重置

### 2. 多产品单日录入测试

#### 2.1 基础功能测试
- [ ] 切换到"多产品单日录入"标签页
- [ ] 页面正常加载，无控制台错误

#### 2.2 日期选择功能
- [ ] 可以选择日期
- [ ] 选择日期后，日期信息卡片正确显示
- [ ] 日期格式正确（YYYY年MM月DD日）

#### 2.3 产品选择功能
- [ ] 每行可以独立搜索和选择产品
- [ ] 选择产品后，币种自动显示
- [ ] 不能重复选择同一产品
- [ ] 重复选择时显示警告

#### 2.4 数据录入功能
- [ ] 默认显示一行空白记录
- [ ] 点击"添加产品"按钮，成功添加新行
- [ ] 未选择产品时，价格输入框禁用
- [ ] 选择产品后，价格输入框启用
- [ ] 可以输入收盘价（必填）
- [ ] 可以输入开盘价、最高价、最低价（可选）

#### 2.5 数据验证
- [ ] 未选择日期时，点击保存提示"请选择日期"
- [ ] 未填写任何完整记录时，提示错误
- [ ] 价格逻辑验证正确（同单产品多日录入）

#### 2.6 保存功能
- [ ] 填写有效数据后，点击保存
- [ ] 显示加载状态
- [ ] 保存成功后显示成功消息
- [ ] 数据自动清空
- [ ] 有效记录数统计正确

### 3. 后端 API 测试

#### 3.1 批量价格更新 API
```bash
# 测试命令（需要先登录获取 token）
curl -X POST http://localhost:8000/api/assets/prices/bulk \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "updates": [
      {
        "assetId": "ASSET_UUID",
        "priceDate": "2025-10-26",
        "closePrice": 100.50,
        "openPrice": 99.80,
        "highPrice": 101.20,
        "lowPrice": 99.50,
        "currency": "CNY",
        "dataSource": "MANUAL"
      }
    ]
  }'
```

- [ ] API 返回 200 状态码
- [ ] 响应包含成功统计信息
- [ ] 数据库中正确插入/更新记录
- [ ] 重复提交时正确更新现有记录

#### 3.2 资产搜索 API
```bash
curl -X GET "http://localhost:8000/api/assets/search?keyword=腾讯&limit=20&isActive=true" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

- [ ] API 返回 200 状态码
- [ ] 返回匹配的资产列表
- [ ] 数据格式正确

### 4. 数据库验证

#### 4.1 检查价格数据
```sql
-- 查看最近插入的价格记录
SELECT 
  ap.id,
  a.symbol,
  a.name,
  ap.price_date,
  ap.open_price,
  ap.high_price,
  ap.low_price,
  ap.close_price,
  ap.currency,
  ap.data_source,
  ap.created_at
FROM asset_prices ap
JOIN assets a ON ap.asset_id = a.id
ORDER BY ap.created_at DESC
LIMIT 10;
```

- [ ] 价格记录正确插入
- [ ] 字段值正确
- [ ] data_source 为 'MANUAL'
- [ ] 重复日期时正确更新

#### 4.2 检查唯一约束
```sql
-- 检查是否有重复的 (asset_id, price_date)
SELECT 
  asset_id, 
  price_date, 
  COUNT(*) as count
FROM asset_prices
GROUP BY asset_id, price_date
HAVING COUNT(*) > 1;
```

- [ ] 没有重复记录

### 5. 边界情况测试

#### 5.1 大批量数据
- [ ] 单次提交 50 条记录
- [ ] 单次提交 100 条记录
- [ ] 观察性能和响应时间

#### 5.2 特殊字符和数值
- [ ] 价格为 0.0001（小数点后4位）
- [ ] 价格为 999999.9999（大数值）
- [ ] 日期为今天
- [ ] 日期为历史日期（如 2020-01-01）

#### 5.3 网络错误处理
- [ ] 关闭后端服务，测试前端错误提示
- [ ] 网络延迟时的加载状态
- [ ] 超时处理

### 6. 用户体验测试

#### 6.1 界面响应
- [ ] 按钮点击有视觉反馈
- [ ] 加载状态清晰
- [ ] 错误提示明确
- [ ] 成功提示友好

#### 6.2 数据持久化
- [ ] 保存后数据正确存储
- [ ] 刷新页面后可以查看历史数据
- [ ] 更新现有数据正确覆盖

#### 6.3 使用说明
- [ ] 使用说明清晰易懂
- [ ] 必填项标记明显
- [ ] 统计信息准确

## 测试结果记录

### 发现的问题
1. 
2. 
3. 

### 需要改进的地方
1. 
2. 
3. 

### 测试通过情况
- 单产品多日录入：[ ] 通过 / [ ] 未通过
- 多产品单日录入：[ ] 通过 / [ ] 未通过
- 后端 API：[ ] 通过 / [ ] 未通过
- 数据库验证：[ ] 通过 / [ ] 未通过

## 测试人员
- 姓名：
- 日期：
- 版本：Phase 1

## 备注
