================================================================================
                    ä½ç½®ç»´åº¦å¿«é€Ÿå‚è€ƒæŒ‡å—
================================================================================

ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ
================================================================================
èµ„äº§ç±»å‹å¯ä»¥é‡‡ç”¨ä¸åŒçš„åœ°ç†ä½ç½®ç»´åº¦ï¼š
  â€¢ å¸‚åœºç»´åº¦ (market)    â† åœ¨äº¤æ˜“æ‰€äº¤æ˜“çš„èµ„äº§
  â€¢ å›½å®¶ç»´åº¦ (country)   â† ç”±å›½å®¶/åœ°åŒºå‘è¡Œçš„èµ„äº§
  â€¢ å…¨çƒç»´åº¦ (global)    â† å…¨çƒäº¤æ˜“çš„èµ„äº§

================================================================================
èµ„äº§ç±»å‹åˆ†ç±»é€ŸæŸ¥è¡¨
================================================================================

ã€å¸‚åœºç»´åº¦ã€‘(location_dimension = 'market')
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  STOCK          è‚¡ç¥¨ï¼ˆNYSEã€NASDAQã€SSE ç­‰ï¼‰
  ETF            äº¤æ˜“æ‰€äº¤æ˜“åŸºé‡‘
  FUTURE         æœŸè´§
  OPTION         æœŸæƒ
  STOCK_OPTION   è‚¡ç¥¨æœŸæƒ

  å¿…å¡«ï¼šmarket_id
  å¯é€‰ï¼šcountry_id

ã€å›½å®¶ç»´åº¦ã€‘(location_dimension = 'country')
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BOND           å€ºåˆ¸ï¼ˆå›½å€ºã€å…¬å¸å€ºï¼‰
  WEALTH_NAV     å‡€å€¼å‹ç†è´¢äº§å“
  WEALTH_BALANCE ä½™é¢å‹ç†è´¢äº§å“
  MUTUAL_FUND    å…±åŒåŸºé‡‘
  FUND           åŸºé‡‘
  REIT           æˆ¿åœ°äº§æŠ•èµ„ä¿¡æ‰˜
  CASH           ç°é‡‘/è´§å¸

  å¿…å¡«ï¼šcountry_id
  å¯é€‰ï¼šmarket_id

ã€å…¨çƒç»´åº¦ã€‘(location_dimension = 'global')
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CRYPTO         åŠ å¯†è´§å¸ï¼ˆBTCã€ETHï¼‰
  COMMODITY      å•†å“ï¼ˆé»„é‡‘ã€åŸæ²¹ï¼‰

  å¯é€‰ï¼šmarket_idã€country_id

================================================================================
æ•°æ®æºé…ç½®å‚è€ƒ
================================================================================

ã€ä»…æ”¯æŒå¸‚åœºç»´åº¦èµ„äº§ã€‘
  {
    "supports_products": ["STOCK", "ETF"],
    "supports_markets": ["NYSE", "NASDAQ"]
  }

ã€ä»…æ”¯æŒå›½å®¶ç»´åº¦èµ„äº§ã€‘
  {
    "supports_products": ["BOND", "WEALTH_NAV", "WEALTH_BALANCE"],
    "supports_countries": ["CN", "US"]
  }

ã€æ··åˆæ”¯æŒã€‘
  {
    "supports_products": ["STOCK", "BOND"],
    "supports_markets": ["NYSE"],
    "supports_countries": ["US"]
  }

================================================================================
API æ–¹æ³•é€ŸæŸ¥
================================================================================

1ï¸âƒ£ æŸ¥è¯¢èµ„äº§ç±»å‹ä½ç½®ç»´åº¦
   
   const dimension = await priceSyncService.getAssetTypeLocationDimension("STOCK");
   // è¿”å›: 'market' | 'country' | 'global'

2ï¸âƒ£ è·å–å¸‚åœºåˆ—è¡¨ï¼ˆå¸‚åœºç»´åº¦ï¼‰
   
   const markets = await priceSyncService.getMarketsByDataSourceAndAssetType(
     dataSourceId,
     "STOCK"
   );
   // è¿”å›: Array<{ id, code, name }>

3ï¸âƒ£ è·å–å›½å®¶åˆ—è¡¨ï¼ˆå›½å®¶ç»´åº¦ï¼‰
   
   const countries = await priceSyncService.getCountriesByDataSourceAndAssetType(
     dataSourceId,
     "BOND"
   );
   // è¿”å›: Array<{ id, code, name }>

4ï¸âƒ£ è·å–å®Œæ•´è¦†ç›–èŒƒå›´ï¼ˆæ¨èï¼‰
   
   const coverage = await priceSyncService.getDataSourceFullCoverage(dataSourceId);
   // è¿”å›: {
   //   supportedMarkets: [...],
   //   supportedCountries: [...],
   //   productTypesCoverage: [{
   //     code: "STOCK",
   //     locationDimension: "market",
   //     coverage: [...]
   //   }, ...]
   // }

================================================================================
å¸¸è§æ“ä½œ
================================================================================

ã€åˆ›å»ºè‚¡ç¥¨èµ„äº§ã€‘
  {
    symbol: "AAPL",
    assetTypeId: "STOCK",        â† location_dimension='market'
    marketId: "NASDAQ_UUID",     âœ… å¿…å¡«
    countryId: null              âŒ ä¸éœ€è¦
  }

ã€åˆ›å»ºå€ºåˆ¸èµ„äº§ã€‘
  {
    symbol: "CNB10",
    assetTypeId: "BOND",         â† location_dimension='country'
    marketId: null               âŒ ä¸éœ€è¦
    countryId: "CN_UUID"         âœ… å¿…å¡«
  }

ã€åˆ›å»ºåŠ å¯†è´§å¸ã€‘
  {
    symbol: "BTC",
    assetTypeId: "CRYPTO",       â† location_dimension='global'
    marketId: null               âŒ å¯é€‰
    countryId: null              âŒ å¯é€‰
  }

================================================================================
æ•°æ®éªŒè¯è§„åˆ™
================================================================================

åˆ›å»ºæˆ–æ›´æ–°èµ„äº§æ—¶æ£€æŸ¥æ¸…å•ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. è·å– asset_type çš„ location_dimension      â”‚
  â”‚ 2. æ ¹æ® location_dimension éªŒè¯ä½ç½®å­—æ®µï¼š     â”‚
  â”‚    â€¢ market    â†’ market_id å¿…é¡»å¡«å……            â”‚
  â”‚    â€¢ country   â†’ country_id å¿…é¡»å¡«å……           â”‚
  â”‚    â€¢ global    â†’ ä¸¤è€…éƒ½æ˜¯å¯é€‰çš„                â”‚
  â”‚ 3. å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
å‰ç«¯é›†æˆç¤ºä¾‹
================================================================================

ã€çº§è”é€‰æ‹©å™¨ã€‘
  
  // æ­¥éª¤1ï¼šé€‰æ‹©æ•°æ®æº
  const selectedDataSource = "bloomberg";
  
  // æ­¥éª¤2ï¼šè·å–å®Œæ•´è¦†ç›–èŒƒå›´
  const coverage = await getDataSourceFullCoverage(selectedDataSource);
  
  // æ­¥éª¤3ï¼šæ˜¾ç¤ºäº§å“ç±»å‹
  <select onChange={(e) => setProductType(e.target.value)}>
    {coverage.productTypesCoverage.map(pt => (
      <option key={pt.code}>{pt.name}</option>
    ))}
  </select>
  
  // æ­¥éª¤4ï¼šæ ¹æ®ä½ç½®ç»´åº¦æ˜¾ç¤ºåŠ¨æ€ç¬¬äºŒé€‰æ‹©å™¨
  {selectedProductType.locationDimension === 'market' ? (
    <select label="Market">
      {selectedProductType.coverage.map(m => (
        <option key={m.code}>{m.name}</option>
      ))}
    </select>
  ) : selectedProductType.locationDimension === 'country' ? (
    <select label="Country">
      {selectedProductType.coverage.map(c => (
        <option key={c.code}>{c.name}</option>
      ))}
    </select>
  ) : null}

================================================================================
æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹
================================================================================

ã€æŸ¥è¯¢æŸå›½å®¶çš„æ‰€æœ‰å€ºåˆ¸ã€‘
  SELECT a.* FROM finapp.assets a
  JOIN finapp.asset_types t ON a.asset_type_id = t.id
  WHERE t.code = 'BOND' AND a.country_id = 'CN_UUID'
  ORDER BY a.symbol;

ã€æŸ¥è¯¢æŸå¸‚åœºçš„æ‰€æœ‰è‚¡ç¥¨ã€‘
  SELECT a.* FROM finapp.assets a
  JOIN finapp.asset_types t ON a.asset_type_id = t.id
  WHERE t.code = 'STOCK' AND a.market_id = 'NASDAQ_UUID'
  ORDER BY a.symbol;

ã€æŸ¥è¯¢æ•°æ®æºæ”¯æŒçš„æ‰€æœ‰äº§å“ç±»å‹åŠå…¶ç»´åº¦ã€‘
  SELECT DISTINCT 
    at.code, 
    at.name, 
    at.location_dimension
  FROM finapp.asset_types at
  WHERE at.code = ANY(
    (SELECT config->'supports_products' 
     FROM finapp.price_data_sources 
     WHERE id = 'DATASOURCE_UUID')::text[]
  );

================================================================================
å¸¸è§é”™è¯¯å’Œä¿®å¤
================================================================================

âŒ é”™è¯¯1ï¼šè‚¡ç¥¨èµ„äº§æ²¡æœ‰ market_id
   ç—‡çŠ¶ï¼šæŸ¥è¯¢è‚¡ç¥¨æ—¶æ‰¾ä¸åˆ°å¯¹åº”çš„å¸‚åœºä¿¡æ¯
   åŸå› ï¼šè‚¡ç¥¨æ˜¯å¸‚åœºç»´åº¦èµ„äº§ï¼Œå¿…é¡»å…³è”å¸‚åœº
   ä¿®å¤ï¼šæ‰§è¡Œ UPDATE finapp.assets SET market_id = 'xxx' WHERE ...

âŒ é”™è¯¯2ï¼šå€ºåˆ¸èµ„äº§æ²¡æœ‰ country_id
   ç—‡çŠ¶ï¼šæŸ¥è¯¢å€ºåˆ¸æ—¶æ— æ³•ç¡®å®šæ‰€å±å›½å®¶
   åŸå› ï¼šå€ºåˆ¸æ˜¯å›½å®¶ç»´åº¦èµ„äº§ï¼Œå¿…é¡»å…³è”å›½å®¶
   ä¿®å¤ï¼šæ‰§è¡Œ UPDATE finapp.assets SET country_id = 'xxx' WHERE ...

âŒ é”™è¯¯3ï¼šåŒæ—¶å¡«å…… market_id å’Œ country_id
   ç—‡çŠ¶ï¼šæ•°æ®æ¨¡ç³Šä¸æ¸…ï¼ŒæŸ¥è¯¢é€»è¾‘æ··ä¹±
   åŸå› ï¼šèµ„äº§ç±»å‹å·²å®šä¹‰äº†æ­£ç¡®çš„ç»´åº¦ï¼Œå¡«å……æ— å…³å­—æ®µä¼šå¯¼è‡´æ··æ·†
   ä¿®å¤ï¼šæ ¹æ® asset_type çš„ location_dimension åªå¡«å……ç›¸å…³å­—æ®µ

âŒ é”™è¯¯4ï¼šæ•°æ®æºé…ç½®ä¸­ supports_products å’Œ supports_markets/countries ä¸åŒ¹é…
   ç—‡çŠ¶ï¼šæ— æ³•è·å–æŸäº›èµ„äº§çš„æ•°æ®
   åŸå› ï¼šé…ç½®ä¸­çš„äº§å“ç±»å‹å’Œæ”¯æŒçš„ä½ç½®ç»´åº¦ä¸ä¸€è‡´
   ä¿®å¤ï¼šæ›´æ–°æ•°æ®æºé…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§

================================================================================
æ€»ç»“ï¼šä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªç»´åº¦ï¼Ÿ
================================================================================

  åœ¨äº¤æ˜“æ‰€äº¤æ˜“å—ï¼Ÿ
       â†“
    â”Œâ”€â”€â”´â”€â”€â”
   æ˜¯    å¦
   â†“     â†“
  å¸‚åœº  åœ¨ç‰¹å®šå›½å®¶/åœ°åŒºå—ï¼Ÿ
   â†“     â†“
       â”Œâ”€â”€â”´â”€â”€â”
      æ˜¯    å¦
      â†“     â†“
    å›½å®¶   å…¨çƒ
   
   å¸‚åœºç»´åº¦: STOCK, ETF, FUTURE, OPTION
   å›½å®¶ç»´åº¦: BOND, WEALTH_NAV, WEALTH_BALANCE, FUND, REIT, CASH
   å…¨çƒç»´åº¦: CRYPTO, COMMODITY

================================================================================
æ›´å¤šä¿¡æ¯
================================================================================

è¯¦ç»†æ–‡æ¡£ï¼š
  â€¢ ASSET_TYPE_LOCATION_DIMENSION.md      - å®Œæ•´ç”¨æˆ·æŒ‡å—
  â€¢ ASSET_TYPE_LOCATION_SOLUTION.md       - æŠ€æœ¯å®ç°ç»†èŠ‚

æ•°æ®åº“è¡¨ï¼š
  â€¢ asset_types.location_dimension        - ä½ç½®ç»´åº¦å­—æ®µ
  â€¢ assets.market_id                      - å¸‚åœºå…³è”
  â€¢ assets.country_id                     - å›½å®¶å…³è”
  â€¢ countries                             - å›½å®¶ä¸»æ•°æ®
  â€¢ markets                               - å¸‚åœºä¸»æ•°æ®

================================================================================
