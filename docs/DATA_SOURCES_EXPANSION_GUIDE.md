# æ•°æ®æºæ‰©å±•æŒ‡å—

## å½“å‰å·²æ”¯æŒçš„æ•°æ®æº

### 1. Yahoo Financeï¼ˆé›…è™è´¢ç»ï¼‰
- **æä¾›å•†ä»£ç **: `yahoo_finance`
- **API ç«¯ç‚¹**: `https://query1.finance.yahoo.com/v8/finance/chart/{symbol}`
- **æ”¯æŒçš„èµ„äº§ç±»å‹**:
  - âœ… è‚¡ç¥¨ï¼ˆç¾è‚¡ã€æ¸¯è‚¡ã€Aè‚¡ã€æ—¥è‚¡ã€æ¬§è‚¡ï¼‰
  - âœ… ETF
  - âœ… æŒ‡æ•°
- **æ”¯æŒçš„å¸‚åœº**:
  - ç¾å›½ï¼ˆNYSEã€NASDAQï¼‰
  - ä¸­å›½ï¼ˆSSE ä¸Šäº¤æ‰€ã€SZSE æ·±äº¤æ‰€ï¼‰
  - é¦™æ¸¯ï¼ˆHKEX é¦™æ¸¯äº¤æ˜“æ‰€ï¼‰
  - æ—¥æœ¬ï¼ˆTSE ä¸œäº¬äº¤æ˜“æ‰€ï¼‰
  - è‹±å›½ï¼ˆLSE ä¼¦æ•¦äº¤æ˜“æ‰€ï¼‰
  - å¾·å›½ï¼ˆFWB æ³•å…°å…‹ç¦äº¤æ˜“æ‰€ï¼‰
- **æ•°æ®ç±»å‹**: æ—¥Kçº¿æ•°æ®ï¼ˆopen, high, low, close, volumeï¼‰
- **ç‰¹ç‚¹**:
  - âœ… å…è´¹ä½¿ç”¨ï¼Œæ— éœ€ API Key
  - âœ… å†å²æ•°æ®å®Œæ•´ï¼ˆ10+ å¹´ï¼‰
  - âš ï¸ æœ‰é™æµé™åˆ¶ï¼ˆ~2000 è¯·æ±‚/å°æ—¶ï¼‰
  - âœ… æœ€åä¸€ä¸ªäº¤æ˜“æ—¥é€šå¸¸å»¶è¿Ÿ 15-20 åˆ†é’Ÿ

### 2. ä¸œæ–¹è´¢å¯Œï¼ˆEastMoneyï¼‰
- **æä¾›å•†ä»£ç **: `eastmoney`
- **API ç«¯ç‚¹**: `http://push2.eastmoney.com/api/qt/stock/kline/get`
- **æ”¯æŒçš„èµ„äº§ç±»å‹**:
  - âœ… A è‚¡ï¼ˆæ²ªæ·±è‚¡ç¥¨ï¼‰
  - âœ… ETF
  - âœ… åŸºé‡‘
- **ç‰¹ç‚¹**:
  - âœ… å…è´¹ä½¿ç”¨ï¼Œæ— éœ€ API Key
  - âœ… ä¸“é—¨é’ˆå¯¹ä¸­å›½è‚¡å¸‚æ•°æ®ä¼˜åŒ–
  - âœ… å®æ—¶æ€§å¥½ï¼Œå»¶è¿Ÿå°‘
  - âœ… æ”¯æŒå‰å¤æƒã€åå¤æƒæ•°æ®
- **å½“å‰çŠ¶æ€**: ä»£ç å·²å®ç°ä½†æœªæ¿€æ´»

### 3. Tushareï¼ˆèšå®½æ•°æ®ï¼‰
- **æä¾›å•†ä»£ç **: `tushare`
- **API ç«¯ç‚¹**: `http://api.tushare.pro`
- **æ”¯æŒçš„èµ„äº§ç±»å‹**:
  - âœ… A è‚¡
  - âœ… åŸºé‡‘
  - âœ… å€ºåˆ¸
  - âœ… æœŸè´§
  - âœ… æœŸæƒ
  - âœ… æ•°å­—èµ„äº§
- **æ•°æ®ç±»å‹**: æ—¥Kçº¿æ•°æ®ã€åŸºæœ¬ä¿¡æ¯ã€è´¢åŠ¡æ•°æ®ç­‰
- **ç‰¹ç‚¹**:
  - ğŸ”‘ éœ€è¦ API Tokenï¼ˆå…è´¹è´¦æˆ·æœ‰é™åˆ¶ï¼‰
  - ğŸ“Š æ•°æ®æœ€å…¨é¢
  - ğŸ’° éƒ¨åˆ†æ•°æ®éœ€è¦ä»˜è´¹
  - âœ… å½“å‰å·²æ¿€æ´»ï¼Œéœ€é…ç½® API Key
- **å½“å‰çŠ¶æ€**: å·²é›†æˆï¼Œç­‰å¾…é…ç½® API Key

---

## æ¨èæ·»åŠ çš„æ–°æ•°æ®æº

### ä¸€çº§æ¨èï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 1. **Alpha Vantage**ï¼ˆç¾è‚¡ + æ±‡ç‡æ•°æ®ï¼‰
- **ç”¨é€”**: ç¾è‚¡æ•°æ®ã€æ±‡ç‡ã€æŠ€æœ¯æŒ‡æ ‡
- **ç‰¹ç‚¹**:
  - å…è´¹ APIï¼ˆ500 è¯·æ±‚/å¤©ï¼‰
  - æä¾›ç¾è‚¡ã€ETFã€åŸºé‡‘ã€å¤–æ±‡æ•°æ®
  - åŒ…å«æŠ€æœ¯æŒ‡æ ‡ï¼ˆRSIã€MACD ç­‰ï¼‰
- **é…ç½®**:
  ```javascript
  {
    provider: "alpha_vantage",
    api_endpoint: "https://www.alphavantage.co/query",
    config: {
      data_types: ["daily_price", "technical_indicators", "fx_data"],
      functions: ["TIME_SERIES_DAILY", "FX_DAILY", "RSI", "MACD"],
      sync_frequency: "daily"
    },
    rate_limit: 12  // æ¯åˆ†é’Ÿ
  }
  ```
- **æ³¨å†Œ**: https://www.alphavantage.co/

#### 2. **IEX Cloud**ï¼ˆç¾è‚¡è¯¦ç»†æ•°æ®ï¼‰
- **ç”¨é€”**: ç¾è‚¡æ—¥Kã€åˆ†é’Ÿçº§æ•°æ®ã€å…¬å¸ä¿¡æ¯ã€æ–°é—»
- **ç‰¹ç‚¹**:
  - å¾®ä¿¡ APIï¼ˆ100 è¯·æ±‚/æœˆå…è´¹ï¼‰
  - æ•°æ®æœ€æ–°å®æ—¶
  - æ”¯æŒæœŸæƒã€æœŸè´§æ•°æ®
- **é…ç½®**:
  ```javascript
  {
    provider: "iex_cloud",
    api_endpoint: "https://cloud.iexapis.com/stable",
    config: {
      data_types: ["daily_price", "company_info", "news"],
      sync_frequency: "daily"
    },
    rate_limit: 100
  }
  ```
- **æ³¨å†Œ**: https://iexcloud.io/

#### 3. **FREDï¼ˆç¾å›½å€ºåˆ¸æ•°æ®ï¼‰**
- **ç”¨é€”**: ç¾å›½å›½å€ºæ•°æ®ã€ç»æµæŒ‡æ ‡
- **ç‰¹ç‚¹**:
  - âœ… å®Œå…¨å…è´¹
  - ğŸ“Š æ•°æ®æƒå¨ï¼ˆç¾è”å‚¨æ•°æ®åº“ï¼‰
  - æ”¯æŒå›½å€ºæ”¶ç›Šç‡ã€ç»æµæŒ‡æ ‡ç­‰
- **é…ç½®**:
  ```javascript
  {
    provider: "fred",
    api_endpoint: "https://api.stlouisfed.org/fred",
    config: {
      data_types: ["treasury_yields", "economic_indicators"],
      series_ids: [
        "DFF",      // è”é‚¦åŸºé‡‘åˆ©ç‡
        "DGS1",     // 1å¹´æœŸå›½å€º
        "DGS5",     // 5å¹´æœŸå›½å€º
        "DGS10",    // 10å¹´æœŸå›½å€º
        "DGS30"     // 30å¹´æœŸå›½å€º
      ],
      sync_frequency: "daily"
    },
    rate_limit: 60
  }
  ```
- **æ³¨å†Œ**: https://fred.stlouisfed.org/

#### 4. **Polygon.io**ï¼ˆè‚¡ç¥¨ + æœŸæƒ + åŠ å¯†ï¼‰
- **ç”¨é€”**: ç¾è‚¡ã€æœŸæƒã€åŠ å¯†èµ„äº§æ•°æ®
- **ç‰¹ç‚¹**:
  - å…è´¹ API
  - æ”¯æŒç¾è‚¡ã€æœŸæƒã€åŠ å¯†èµ„äº§
  - å®æ—¶æ•°æ®å’Œå†å²æ•°æ®
- **é…ç½®**:
  ```javascript
  {
    provider: "polygon",
    api_endpoint: "https://api.polygon.io",
    config: {
      data_types: ["daily_price", "options_data", "crypto"],
      sync_frequency: "daily"
    },
    rate_limit: 5
  }
  ```
- **æ³¨å†Œ**: https://polygon.io/

---

### äºŒçº§æ¨èï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 5. **å¤©å¤©åŸºé‡‘ API**ï¼ˆåŸºé‡‘æ•°æ®ï¼‰
- **ç”¨é€”**: ä¸­å›½å…¬å‹ŸåŸºé‡‘ã€åŸºé‡‘æ’åã€æŒä»“æ•°æ®
- **ç‰¹ç‚¹**:
  - ä¸­å›½åŸºé‡‘æ•°æ®æœ€å…¨
  - åŒ…å«å‡€å€¼ã€æ’åã€æŒä»“ç­‰
- **æ³¨å†Œ**: http://api.fund.eastmoney.com/

#### 6. **æ–°æµªè´¢ç» API**ï¼ˆå…¨çƒæ•°æ®ï¼‰
- **ç”¨é€”**: Aè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡ã€åŸºé‡‘ç»¼åˆæ•°æ®
- **ç‰¹ç‚¹**:
  - å…è´¹ä½¿ç”¨
  - æ•°æ®é½å…¨
  - æœ‰åˆ†é’Ÿçº§æ•°æ®

#### 7. **QUANDL**ï¼ˆæ›¿ä»£æ•°æ®ï¼‰
- **ç”¨é€”**: å€ºåˆ¸ã€æœŸè´§ã€å•†å“æ•°æ®
- **ç‰¹ç‚¹**:
  - å…è´¹è´¦æˆ·ï¼ˆ100 è¯·æ±‚/å¤©ï¼‰
  - ä¸°å¯Œçš„æ›¿ä»£æ•°æ®æº
  - ä¸“ä¸šçº§æ•°æ®è´¨é‡

#### 8. **Tiingo**ï¼ˆå…¨çƒè‚¡ç¥¨ï¼‰
- **ç”¨é€”**: å…¨çƒè‚¡ç¥¨ã€å¤–æ±‡ã€åŠ å¯†
- **ç‰¹ç‚¹**:
  - å…è´¹ API
  - å®æ—¶æ•°æ®
  - æ”¯æŒ 100+ å›½å®¶è‚¡å¸‚

---

## æŒ‰èµ„äº§ç±»å‹æ¨èçš„æ•°æ®æºç»„åˆ

### ğŸ“ˆ è‚¡ç¥¨æ•°æ®
- **ä¼˜å…ˆ**: Yahoo Financeï¼ˆå…¨çƒï¼‰+ Tushareï¼ˆAè‚¡ï¼‰+ EastMoneyï¼ˆAè‚¡ï¼‰
- **å¤‡é€‰**: IEX Cloudï¼ˆç¾è‚¡ï¼‰+ Alpha Vantageï¼ˆç¾è‚¡ï¼‰+ Polygon.ioï¼ˆç¾è‚¡ï¼‰
- **æ¸¯è‚¡ç‰¹åˆ«**: Yahoo Financeï¼ˆæ¨èï¼‰

### ğŸ’° ç¾å›½å€ºåˆ¸æ•°æ®
- **æ¨è**: FREDï¼ˆå®˜æ–¹æƒå¨ï¼‰+ IEX Cloudï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰
- **å¤‡é€‰**: Alpha Vantageï¼ˆæŠ€æœ¯æŒ‡æ ‡ï¼‰

### ğŸ¦ åŸºé‡‘æ•°æ®
- **Aè‚¡åŸºé‡‘**: EastMoneyï¼ˆæ¨èï¼‰+ å¤©å¤©åŸºé‡‘ APIï¼ˆè¯¦ç»†æŒä»“ï¼‰+ Tushareï¼ˆéœ€ä»˜è´¹ï¼‰
- **ç¾å›½åŸºé‡‘**: Yahoo Financeï¼ˆETFï¼‰+ Polygon.ioï¼ˆè¯¦ç»†æ•°æ®ï¼‰

### ğŸ“Š æ±‡ç‡æ•°æ®
- **æ¨è**: Alpha Vantageï¼ˆ10+ ç§å¤–å¸ï¼‰+ Yahoo Financeï¼ˆä¸»è¦è´§å¸å¯¹ï¼‰

---

## å®ç°æŒ‡å—

### æ·»åŠ æ–°æ•°æ®æºçš„æ­¥éª¤

#### 1. **åç«¯å®ç°** (`backend/src/services/PriceSyncService.ts`)

```typescript
// 1. åœ¨ fetchPricesFromSource æ–¹æ³•ä¸­æ·»åŠ  case
case 'alpha_vantage':
  return await this.fetchFromAlphaVantage(dataSource, asset, daysBack);

// 2. å®ç°å¯¹åº”çš„ fetch æ–¹æ³•
private async fetchFromAlphaVantage(
  dataSource: DataSource,
  asset: any,
  daysBack: number
): Promise<any[]> {
  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - daysBack);

  try {
    const response = await axios.get(
      `${dataSource.api_endpoint}`,
      {
        params: {
          function: 'TIME_SERIES_DAILY',
          symbol: asset.symbol,
          apikey: dataSource.api_key_encrypted,
          outputsize: 'full'
        },
        timeout: 30000
      }
    );

    // æ•°æ®è½¬æ¢...
    const timeSeries = response.data['Time Series (Daily)'] || {};
    const prices = Object.entries(timeSeries).map(([date, data]: any) => ({
      date,
      open: parseFloat(data['1. open']),
      high: parseFloat(data['2. high']),
      low: parseFloat(data['3. low']),
      close: parseFloat(data['4. close']),
      volume: parseInt(data['5. volume']),
      currency: asset.currency || 'USD'
    }));

    return prices;
  } catch (error) {
    console.error(`Error fetching from Alpha Vantage:`, error);
    throw error;
  }
}
```

#### 2. **å‰ç«¯é…ç½®**

åœ¨"æ•°æ®åŒæ­¥"â†’"æ•°æ®æº"é¡µé¢æ·»åŠ æ–°æ•°æ®æºï¼š
- åç§°ï¼š`Alpha Vantage - ç¾è‚¡æ•°æ®æº`
- æä¾›å•†ï¼š`alpha_vantage`
- API ç«¯ç‚¹ï¼š`https://www.alphavantage.co/query`
- API Keyï¼šé…ç½®å®é™…çš„ API Key
- é…ç½®ï¼š`{"data_types": ["daily_price", "technical_indicators"]}`
- é€Ÿç‡é™åˆ¶ï¼š`12`ï¼ˆæ¯åˆ†é’Ÿè¯·æ±‚æ•°ï¼‰

#### 3. **æ•°æ®åº“åˆå§‹åŒ–** (SQL)

```sql
INSERT INTO finapp.price_data_sources (
    name, provider, api_endpoint, api_key_encrypted, config,
    rate_limit, timeout_seconds, is_active
) VALUES (
    'Alpha Vantage - ç¾è‚¡æ•°æ®æº',
    'alpha_vantage',
    'https://www.alphavantage.co/query',
    NULL,  -- éœ€è¦é…ç½®å®é™…çš„ API Key
    '{"data_types": ["daily_price", "technical_indicators"], "sync_frequency": "daily"}'::jsonb,
    12,
    30,
    true
);
```

---

## æˆæœ¬å¯¹æ¯”

| æ•°æ®æº | ä»·æ ¼ | è¦†ç›–èŒƒå›´ | é€‚åˆåœºæ™¯ |
|------|------|---------|--------|
| Yahoo Finance | å…è´¹ | å…¨çƒè‚¡ç¥¨/ETF | å…¥é—¨ç”¨æˆ· |
| Alpha Vantage | å…è´¹(500/å¤©) | ç¾è‚¡/æ±‡ç‡ | ç¾è‚¡æŠ•èµ„ |
| IEX Cloud | å¾®ä¿¡(100/æœˆ) | ç¾è‚¡è¯¦ç»† | ä¸“ä¸šç¾è‚¡ |
| FRED | å…è´¹ | ç¾å›½å€ºåˆ¸ | å€ºåˆ¸æŠ•èµ„ |
| Tushare | å…è´¹(åŸºç¡€åŠŸèƒ½) | Aè‚¡/åŸºé‡‘/æœŸè´§ | é‡åŒ–äº¤æ˜“ |
| EastMoney | å…è´¹ | Aè‚¡/åŸºé‡‘ | å›½å†…æŠ•èµ„ |
| å¤©å¤©åŸºé‡‘ | å…è´¹ | ä¸­å›½åŸºé‡‘ | åŸºé‡‘æŠ•èµ„ |
| Polygon.io | å…è´¹(åŸºç¡€) | ç¾è‚¡/æœŸæƒ/åŠ å¯† | å¤šèµ„äº§ |

---

## å¿«é€Ÿå¼€å§‹å»ºè®®

### ç¬¬ 1 é˜¶æ®µï¼ˆå¿…é¡»ï¼‰
- âœ… æ¿€æ´» Yahoo Financeï¼ˆå·²å®Œæˆï¼‰
- âœ… é…ç½® Tushare API Keyï¼ˆè·å–ï¼‰

### ç¬¬ 2 é˜¶æ®µï¼ˆæ¨èï¼‰
- â­ é›†æˆ Alpha Vantageï¼ˆç¾è‚¡è¡¥å……ï¼‰
- â­ é›†æˆ FREDï¼ˆå€ºåˆ¸æ•°æ®ï¼‰
- â­ æ¿€æ´» EastMoneyï¼ˆAè‚¡å¤‡é€‰ï¼‰

### ç¬¬ 3 é˜¶æ®µï¼ˆå¯é€‰ï¼‰
- IEX Cloudï¼ˆä¸“ä¸šç¾è‚¡ï¼‰
- å¤©å¤©åŸºé‡‘ APIï¼ˆè¯¦ç»†åŸºé‡‘ï¼‰
- Polygon.ioï¼ˆæœŸæƒ/åŠ å¯†ï¼‰

---

## API Key è·å–æµç¨‹

### Alpha Vantage
1. è®¿é—® https://www.alphavantage.co/
2. ç‚¹å‡» "GET FREE API KEY"
3. å¡«å†™é‚®ç®±ï¼Œå³æ—¶è·å¾— API Key

### FRED
1. è®¿é—® https://fred.stlouisfed.org/docs/api/
2. ç‚¹å‡» "Request an API Key"
3. æ³¨å†Œåè·å¾—å…è´¹ API Key

### Tushare
1. è®¿é—® https://tushare.pro/
2. æ³¨å†Œè´¦æˆ·
3. åœ¨ä¸ªäººä¸­å¿ƒè·å¾— API Token

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-07  
**ä¼˜å…ˆçº§**: é«˜  
**çŠ¶æ€**: å»ºè®®æ¸…å•  
