# 🚀 历史数据同步快速开始

## 立即开始（3 步）

### 步骤 1: 打开界面
```
浏览器访问: http://localhost:5173
登录 → 管理后台 → 价格管理 → API 同步
```

### 步骤 2: 创建任务
```
点击"新建任务" → 填写以下信息：

✏️ 任务名称: "补全历史数据"
📊 数据源: Yahoo Finance
🎯 选择资产: 勾选需要同步的资产
📅 回溯天数: 输入天数（见下表）
⚙️ 覆盖已有数据: 关闭（首次同步）
```

### 步骤 3: 执行同步
```
保存 → 点击"执行"按钮 → 等待完成（几秒到几十秒）
```

## 📅 回溯天数速查表

| 需求 | 天数 | 预计记录数* |
|-----|------|-----------|
| 最近 1 个月 | 30 | ~20 |
| 最近 3 个月 | 90 | ~60 |
| 最近半年 | 180 | ~120 |
| **最近 1 年** | **365** | **~250** ⭐ |
| 最近 2 年 | 730 | ~500 |
| **最近 3 年** | **1095** | **~735** ⭐ |
| 最近 5 年 | 1825 | ~1250 |
| **最近 10 年** | **3650** | **~2500** ⭐ |

*基于交易日计算（1年约250个交易日）

## 💡 常见场景

### 场景 1: 新用户首次导入（推荐）
```
目标: 导入持仓资产的 1 年历史数据
步骤:
  1. 选择所有持仓资产（假设 20 个）
  2. 回溯天数: 365
  3. 执行同步
预计: ~5,000 条记录，耗时 ~12 秒
```

### 场景 2: 补全长期历史数据
```
目标: 补全核心资产的 10 年历史数据
步骤:
  1. 选择核心资产（5-10 个）
  2. 回溯天数: 3650
  3. 执行同步
预计: ~25,000 条记录，耗时 ~10-20 秒
```

### 场景 3: 定期更新（每周）
```
目标: 每周更新最新数据
步骤:
  1. 选择所有资产
  2. 回溯天数: 7
  3. 开启"覆盖已有数据"
  4. 设置定时任务: 每周一 18:00
```

## ⚡ 性能参考

| 资产数 | 回溯时间 | 预计耗时 |
|-------|---------|---------|
| 1 个 | 1 年 | ~0.6s |
| 1 个 | 3 年 | ~0.7s |
| 1 个 | 10 年 | ~1-2s |
| 10 个 | 1 年 | ~6s |
| 10 个 | 3 年 | ~7s |
| 50 个 | 1 年 | ~30s |
| 100 个 | 1 年 | ~60s |

## ✅ 验证数据

### 方法 1: 前端查看
```
API 同步 → 同步日志 → 查看最新记录
检查: 总记录数、成功数、失败数
```

### 方法 2: Prisma Studio
```
1. 打开 Prisma Studio: http://localhost:5555
2. 选择 asset_prices 表
3. 筛选: data_source = "api"
4. 查看记录数和日期范围
```

### 方法 3: SQL 查询
```sql
-- 查看某个资产的数据范围
SELECT 
  MIN(price_date) as 开始日期,
  MAX(price_date) as 结束日期,
  COUNT(*) as 记录数
FROM finapp.asset_prices
WHERE asset_id = 'YOUR_ASSET_ID'
  AND data_source = 'api';
```

## ⚠️ 注意事项

### 1. API 限流
```
Yahoo Finance 限制: ~2000 请求/小时
建议:
  - 单次同步 ≤ 50 个资产
  - 大批量同步间隔 ≥ 30 分钟
  - 遇到 429 错误等待 30 分钟
```

### 2. 分批策略
```
如果资产很多，建议分批:
  批次 1: 核心资产 10 个 × 10 年
  批次 2: 重要资产 50 个 × 5 年
  批次 3: 其他资产 × 1 年
```

### 3. 数据完整性
```
注意:
  - 停牌期间无数据
  - 资产上市时间可能晚于回溯起点
  - 周末和节假日无交易数据
```

## 🔧 故障排查

### 问题: 同步后没有数据
```
检查清单:
  □ 资产是否已上市？
  □ Symbol 格式是否正确？
  □ 是否遇到 API 限流？
  □ 查看同步日志的错误信息
```

### 问题: 提示 "Rate limit exceeded"
```
解决方案:
  1. 等待 30 分钟后重试
  2. 减少单次同步的资产数量
  3. 使用其他数据源
```

### 问题: 数据不完整
```
可能原因:
  1. 停牌期间无数据
  2. 资产上市时间晚于回溯起点
  3. 数据源数据缺失

解决方案:
  1. 检查资产上市日期
  2. 尝试其他数据源
  3. 查看同步日志
```

## 📚 更多帮助

- **详细指南**: [LONG_HISTORY_SYNC_GUIDE.md](./LONG_HISTORY_SYNC_GUIDE.md)
- **快速参考**: [HISTORY_SYNC_QUICK_REFERENCE.md](./HISTORY_SYNC_QUICK_REFERENCE.md)
- **修复报告**: [PRICE_SYNC_FIX_COMPLETE.md](./PRICE_SYNC_FIX_COMPLETE.md)
- **限流规则**: [YAHOO_FINANCE_RATE_LIMIT_GUIDE.md](./YAHOO_FINANCE_RATE_LIMIT_GUIDE.md)

## 🎯 推荐配置

### 首次使用（保守）
```
资产数: 10-20 个
回溯天数: 365（1 年）
预计耗时: 6-12 秒
```

### 日常使用（推荐）
```
资产数: 所有持仓资产
回溯天数: 7（1 周）
频率: 每周一次
定时任务: 每周一 18:00
```

### 历史补全（激进）
```
资产数: 核心资产 5-10 个
回溯天数: 3650（10 年）
预计耗时: 10-20 秒
建议: 分批执行，间隔 30 分钟
```

---

**提示**: 
- ✅ 系统已支持最多 10 年（3650 天）的历史数据回溯
- ✅ 性能优秀，3 年数据仅需 0.7 秒
- ✅ 数据自动保存到 asset_prices 表

**开始使用**: 打开 http://localhost:5173 → 管理后台 → 价格管理 → API 同步
