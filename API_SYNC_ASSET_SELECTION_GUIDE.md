# API自动同步 - 资产选择配置指南

## 📋 概述

在创建或编辑API自动同步任务时，您现在可以精确控制要同步哪些资产的价格数据。

## 🎯 资产选择方式

系统提供了三种灵活的资产选择方式，您可以单独使用或组合使用：

### 1. 按资产类型选择

选择特定的资产类型，系统将同步该类型下的所有活跃资产。

**可用的资产类型：**
- 股票 (STOCK)
- 交易所交易基金 (ETF)
- 共同基金 (MUTUAL_FUND)
- 私募基金 (HEDGE_FUND)
- 债券 (BOND)
- 期货 (FUTURE)
- 期权 (OPTION)
- 加密货币 (CRYPTO)
- 商品 (COMMODITY)
- 房地产投资信托 (REIT)
- 现金 (CASH)

**使用场景：**
- 只同步股票价格
- 只同步基金净值
- 只同步加密货币价格

### 2. 按市场选择

选择特定的交易市场，系统将同步该市场下的所有活跃资产。

**可用的市场：**
- 上海证券交易所 (SSE)
- 深圳证券交易所 (SZSE)
- 香港交易所 (HKEX)
- 纽约证券交易所 (NYSE)
- 纳斯达克 (NASDAQ)
- 伦敦证券交易所 (LSE)
- 东京证券交易所 (TSE)
- 法兰克福证券交易所 (FWB)
- 场外交易 (OTC)

**使用场景：**
- 只同步A股（SSE + SZSE）
- 只同步港股（HKEX）
- 只同步美股（NYSE + NASDAQ）

### 3. 选择具体资产

直接选择要同步的具体资产，支持多选。

**使用场景：**
- 只同步投资组合中持有的资产
- 只同步关注列表中的资产
- 测试时选择少量资产

## 📝 配置示例

### 示例 1：同步所有A股

```
任务名称: 每日A股价格同步
数据源: 东方财富
资产类型: 股票
市场: 上海证券交易所 + 深圳证券交易所
具体资产: （留空）
回溯天数: 1
```

### 示例 2：同步特定港股

```
任务名称: 港股重点关注同步
数据源: Yahoo Finance
资产类型: （留空）
市场: 香港交易所
具体资产: 00700-腾讯控股, 03690-美团-W, 09618-京东集团
回溯天数: 7
```

### 示例 3：同步所有基金

```
任务名称: 基金净值同步
数据源: 东方财富
资产类型: 共同基金 + 私募基金
市场: （留空）
具体资产: （留空）
回溯天数: 1
```

### 示例 4：同步所有活跃资产

```
任务名称: 全量价格同步
数据源: Yahoo Finance
资产类型: （留空）
市场: （留空）
具体资产: （留空）
回溯天数: 1
```

**注意：** 如果三个选项都留空，系统将同步所有活跃资产（is_active=true）。

## 🔄 选择逻辑

当您同时选择多个条件时，系统会使用 **AND** 逻辑组合这些条件：

```
同步资产 = 活跃资产 
         AND (资产类型 = 选择的类型 OR 未选择资产类型)
         AND (市场 = 选择的市场 OR 未选择市场)
         AND (资产ID IN 选择的资产列表 OR 未选择具体资产)
```

### 组合示例

**选择：资产类型=股票 + 市场=香港交易所**
- 结果：只同步在香港交易所上市的股票

**选择：资产类型=股票 + 具体资产=[00700, 03690]**
- 结果：只同步这两只股票（即使它们在不同市场）

**选择：市场=纳斯达克 + 具体资产=[BILI]**
- 结果：只同步BILI（哔哩哔哩），如果它在纳斯达克上市

## ⚠️ 重要提示

1. **至少选择一项**：建议至少选择一个条件，否则可能同步大量不需要的数据
2. **测试先行**：首次配置时，建议先选择少量资产进行测试
3. **性能考虑**：同步大量资产可能需要较长时间，建议合理设置回溯天数
4. **数据源限制**：不同数据源支持的市场和资产类型可能不同

## 🧪 测试建议

在正式启用定时任务前，建议：

1. 创建一个手动执行的测试任务
2. 只选择1-3个资产
3. 设置回溯天数为1
4. 手动执行并查看同步日志
5. 确认数据正确后再扩大范围

## 📊 查看同步结果

执行任务后，在"同步日志"标签页可以看到：
- 总资产数：实际同步了多少个资产
- 总记录数：获取了多少条价格记录
- 成功/失败数：同步成功和失败的记录数
- 执行耗时：任务执行花费的时间

---

**最后更新**: 2025-10-26  
**版本**: v1.1
