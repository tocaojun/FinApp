# 产品管理 - 多资产类型详情字段快速测试

## 🚀 快速开始

### 1. 访问产品管理页面

打开浏览器访问：**http://localhost:3001**

然后进入：**产品管理** 或 **管理 → 产品管理**

---

## 📝 测试步骤

### 测试1：创建股票产品

1. **点击"新增产品"按钮**

2. **填写基础信息**：
   - 产品代码：`AAPL`
   - 产品名称：`Apple Inc.`
   - 产品类型：选择 **"股票"** 或 **"STOCK"**
   - 交易市场：选择任意市场
   - 货币：`USD`
   - 风险等级：`中风险`
   - 流动性标签：选择任意标签

3. **观察表单变化** ⭐
   
   选择"股票"后，表单应该自动显示：
   
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   产品详情
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ✅ 行业板块
   ✅ 细分行业
   ✅ 市值
   ✅ 市盈率（P/E）
   ✅ 市净率（P/B）
   ✅ 股息率
   ✅ 流通股数
   ✅ 成立年份
   ✅ 公司网站
   ✅ 总部地址
   ```

4. **填写股票详情**：
   - 行业板块：`科技`
   - 细分行业：`消费电子`
   - 市盈率：`28.5`
   - 市净率：`7.2`
   - 股息率：`0.52`
   - 市值：`2800000000000`

5. **提交并验证**：
   - ✅ 提示"产品创建成功"
   - ✅ 产品列表中出现新产品

---

### 测试2：创建基金产品

1. **点击"新增产品"按钮**

2. **填写基础信息**：
   - 产品代码：`000001`
   - 产品名称：`华夏成长混合`
   - 产品类型：选择 **"基金"** 或 **"FUND"**
   - 交易市场：选择任意市场
   - 货币：`CNY`
   - 风险等级：`中风险`
   - 流动性标签：选择任意标签

3. **观察表单变化** ⭐
   
   选择"基金"后，表单应该自动显示：
   
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   产品详情
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ✅ 基金类型（股票型/债券型/混合型等）
   ✅ 净值
   ✅ 累计净值
   ✅ 净值日期
   ✅ 管理费率
   ✅ 托管费率
   ✅ 申购费率
   ✅ 赎回费率
   ✅ 基金规模
   ✅ 基金经理
   ✅ 基金公司
   ✅ 成立日期
   ✅ 最低投资额
   ✅ 最低赎回额
   ```

4. **填写基金详情**：
   - 基金类型：选择 **"混合型"**
   - 净值：`2.3456`
   - 累计净值：`3.1234`
   - 管理费率：`1.5`
   - 托管费率：`0.25`
   - 基金经理：`张三`
   - 基金公司：`华夏基金`

5. **提交并验证**：
   - ✅ 提示"产品创建成功"
   - ✅ 产品列表中出现新产品

---

### 测试3：创建债券产品

1. **点击"新增产品"按钮**

2. **选择产品类型**：**"债券"** 或 **"BOND"**

3. **观察表单变化** ⭐
   
   选择"债券"后，表单应该自动显示：
   
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   产品详情
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ✅ 债券类型（政府债/企业债/可转债等）
   ✅ 信用评级（AAA/AA+等）
   ✅ 面值
   ✅ 票面利率
   ✅ 付息频率
   ✅ 发行日期
   ✅ 到期日期
   ✅ 剩余年限
   ✅ 到期收益率
   ✅ 当前收益率
   ✅ 发行人
   ✅ 发行规模
   ✅ 是否可赎回
   ✅ 赎回日期
   ✅ 赎回价格
   ```

4. **填写债券详情并提交**

---

### 测试4：编辑产品

1. **在产品列表中找到刚创建的股票产品**

2. **点击"编辑"按钮**

3. **验证详情字段加载** ⭐
   
   表单应该正确显示：
   - ✅ 基础信息已填充
   - ✅ 产品类型为"股票"
   - ✅ 自动显示股票详情字段
   - ✅ 详情字段已填充（行业、市盈率等）

4. **修改某些字段**：
   - 市盈率：改为 `30.0`
   - 市净率：改为 `8.0`

5. **提交并验证**：
   - ✅ 提示"产品更新成功"
   - ✅ 数据已更新

---

### 测试5：切换产品类型

1. **点击"新增产品"按钮**

2. **先选择"股票"**
   - 观察显示股票详情字段

3. **切换到"基金"**
   - 观察表单变化为基金详情字段

4. **再切换到"债券"**
   - 观察表单变化为债券详情字段

5. **验证**：
   - ✅ 字段切换流畅
   - ✅ 每种类型显示正确的详情字段

---

## ✅ 成功标志

### 前端表单

- ✅ 选择不同产品类型时，显示不同的详情字段
- ✅ 股票显示：行业、市盈率等
- ✅ 基金显示：基金类型、净值等
- ✅ 债券显示：债券类型、票面利率等
- ✅ 表单切换流畅，无卡顿

### 数据提交

- ✅ 提交时Request包含details字段
- ✅ 后端返回成功响应
- ✅ 响应数据包含details字段

### 数据库验证

```sql
-- 查看股票详情
SELECT 
  a.symbol,
  a.name,
  sd.sector,
  sd.industry,
  sd.pe_ratio,
  sd.pb_ratio
FROM finapp.assets a
JOIN finapp.stock_details sd ON a.id = sd.asset_id
WHERE a.symbol = 'AAPL';

-- 查看基金详情
SELECT 
  a.symbol,
  a.name,
  fd.fund_type,
  fd.nav,
  fd.management_fee,
  fd.fund_manager
FROM finapp.assets a
JOIN finapp.fund_details fd ON a.id = fd.asset_id
WHERE a.symbol = '000001';
```

---

## 🔍 调试技巧

### 1. 查看浏览器控制台

按 `F12` 打开开发者工具，查看：

- **Console标签**：查看是否有JavaScript错误
- **Network标签**：查看API请求和响应

### 2. 检查API请求

在Network标签中，找到POST请求到`/api/assets`：

**Request Payload应该包含**：
```json
{
  "symbol": "AAPL",
  "name": "Apple Inc.",
  "assetTypeId": "xxx",
  "details": {
    "sector": "科技",
    "industry": "消费电子",
    "peRatio": 28.5,
    "pbRatio": 7.2
  }
}
```

### 3. 查看后端日志

```bash
# 实时查看日志
tail -f /tmp/finapp-backend.log

# 搜索错误
grep -i error /tmp/finapp-backend.log
```

---

## ❌ 常见问题

### 问题1：选择产品类型后，详情字段没有显示

**解决方法**：
1. 刷新页面（Ctrl+F5 或 Cmd+Shift+R）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有错误

### 问题2：提交后提示"创建产品失败"

**解决方法**：
1. 检查后端服务是否运行：`ps aux | grep node`
2. 查看后端日志：`tail -f /tmp/finapp-backend.log`
3. 验证数据库连接

### 问题3：详情字段提交了但没有保存

**解决方法**：
1. 检查Network标签，确认Request包含details字段
2. 查看后端日志，确认Controller处理了details
3. 验证数据库表是否存在：
   ```bash
   psql -U finapp_user -d finapp_test -c "\dt finapp.*_details"
   ```

---

## 📊 预期效果对比

### 之前（旧版本）

```
产品类型：[股票 ▼]

行业：[_________]
子行业：[_________]

← 所有产品类型都显示相同的字段
```

### 现在（新版本）

```
产品类型：[股票 ▼]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
产品详情
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

行业板块：[_________]
细分行业：[_________]
市盈率：[_________]
市净率：[_________]
股息率：[_________]
市值：[_________]
...更多股票特有字段

← 根据产品类型显示不同的详情字段
```

---

## 🎉 测试完成

如果以上测试都通过，说明多资产类型详情字段功能已经完全正常工作！

**核心成果**：
- ✅ 不同产品类型的数据项差异性已完全体现
- ✅ 动态表单根据类型自动切换
- ✅ 详情数据正确保存到对应的详情表
- ✅ 编辑功能正常加载和更新详情

---

**测试时间**: 预计 10-15 分钟  
**测试难度**: ⭐⭐☆☆☆（简单）  
**最后更新**: 2025-10-27
