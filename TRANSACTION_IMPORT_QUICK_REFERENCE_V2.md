# 交易批量导入快速参考 v2.0

## 📋 导入流程（3步）

```
1️⃣ 界面选择 → 投资组合 + 交易账户 + 资产
2️⃣ 下载模板 → Excel 或 JSON
3️⃣ 上传文件 → 自动验证并导入
```

---

## 一、界面预选字段

| 字段 | 说明 | 示例 |
|------|------|------|
| **投资组合** | 下拉选择已创建的组合 | `我的投资组合` |
| **交易账户** | 下拉选择该组合下的账户 | `港股账户` |
| **资产** | 搜索选择已存在的资产 | `00700.HK 腾讯控股` |

---

## 二、批量文件必填字段（5个）

| # | 字段 | 类型 | 示例 | 说明 |
|---|------|------|------|------|
| 1 | **date** | Date | `2024-01-15` | YYYY-MM-DD格式，不能是未来 |
| 2 | **type** | Enum | `STOCK_BUY` | 见下方交易类型列表 |
| 3 | **quantity** | Decimal | `100` | 必须 > 0 |
| 4 | **price** | Decimal | `320.5` | 必须 ≥ 0 |
| 5 | **currency** | String | `HKD` | ISO 4217货币代码（3位） |

---

## 三、批量文件可选字段（3个）

| # | 字段 | 类型 | 示例 | 默认值 |
|---|------|------|------|--------|
| 6 | **fee** | Decimal | `10.5` | `0` |
| 7 | **notes** | String | `建仓` | `null` |
| 8 | **tags** | Array | `["长期持有"]` | `[]` |

---

## 四、系统支持的交易类型

### 股票交易
- `STOCK_BUY` - 股票买入
- `STOCK_SELL` - 股票卖出

### 基金交易
- `FUND_SUBSCRIBE` - 基金申购
- `FUND_REDEEM` - 基金赎回

### 债券交易
- `BOND_BUY` - 债券买入
- `BOND_SELL` - 债券卖出

### 期权交易
- `OPTION_BUY` - 期权买入
- `OPTION_SELL` - 期权卖出
- `OPTION_EXERCISE` - 期权行权

### 现金流
- `DEPOSIT` - 存入
- `WITHDRAWAL` - 取出
- `DIVIDEND` - 分红
- `INTEREST` - 利息
- `FEE` - 费用
- `TRANSFER_IN` - 转入
- `TRANSFER_OUT` - 转出

---

## 五、常用币种代码

| 代码 | 币种 | 代码 | 币种 |
|------|------|------|------|
| `CNY` | 人民币 | `USD` | 美元 |
| `HKD` | 港币 | `EUR` | 欧元 |
| `GBP` | 英镑 | `JPY` | 日元 |
| `SGD` | 新加坡元 | `AUD` | 澳元 |

---

## 六、Excel模板示例

### 最小示例（只包含必填字段）

| 日期 | 交易类型 | 数量 | 价格 | 币种 |
|------|---------|------|------|------|
| 2024-01-15 | STOCK_BUY | 100 | 320.5 | HKD |
| 2024-02-20 | STOCK_SELL | 50 | 185.2 | USD |

### 完整示例（包含可选字段）

| 日期 | 交易类型 | 数量 | 价格 | 币种 | 手续费 | 备注 | 标签 |
|------|---------|------|------|------|--------|------|------|
| 2024-01-15 | STOCK_BUY | 100 | 320.5 | HKD | 10 | 建仓 | 长期持有,核心资产 |
| 2024-02-20 | STOCK_SELL | 50 | 185.2 | USD | 5 | 减仓 | |
| 2024-03-10 | DIVIDEND | 100 | 2.5 | HKD | 0 | 分红收入 | 被动收入 |

**注意**: 标签字段多个值用逗号分隔

---

## 七、JSON模板示例

### 最小示例

```json
{
  "transactions": [
    {
      "date": "2024-01-15",
      "type": "STOCK_BUY",
      "quantity": 100,
      "price": 320.5,
      "currency": "HKD"
    }
  ]
}
```

### 完整示例

```json
{
  "transactions": [
    {
      "date": "2024-01-15",
      "type": "STOCK_BUY",
      "quantity": 100,
      "price": 320.5,
      "currency": "HKD",
      "fee": 10,
      "notes": "建仓",
      "tags": ["长期持有", "核心资产"]
    },
    {
      "date": "2024-02-20",
      "type": "STOCK_SELL",
      "quantity": 50,
      "price": 185.2,
      "currency": "USD",
      "fee": 5,
      "notes": "减仓",
      "tags": []
    },
    {
      "date": "2024-03-10",
      "type": "DIVIDEND",
      "quantity": 100,
      "price": 2.5,
      "currency": "HKD",
      "fee": 0,
      "notes": "分红收入",
      "tags": ["被动收入"]
    }
  ]
}
```

---

## 八、常见错误

### ❌ 日期格式错误
```
错误：2024/01/15
正确：2024-01-15
```

### ❌ 交易类型错误
```
错误：BUY
正确：STOCK_BUY
```

### ❌ 币种代码错误
```
错误：RMB
正确：CNY
```

### ❌ 数量为0或负数
```
错误：0 或 -100
正确：100
```

### ❌ 未来日期
```
错误：2025-12-31（假设今天是2024-10-27）
正确：2024-10-27
```

---

## 九、验证规则速查

| 字段 | 规则 |
|------|------|
| **date** | YYYY-MM-DD，不能是未来 |
| **type** | 必须是17种类型之一 |
| **quantity** | > 0，最多8位小数 |
| **price** | ≥ 0，最多8位小数 |
| **currency** | 3位大写字母，ISO 4217 |
| **fee** | ≥ 0，最多8位小数 |
| **notes** | 任意文本 |
| **tags** | 字符串数组 |

---

## 十、导入约束

⚠️ **原子性操作**：一批数据要么全部成功，要么全部失败

⚠️ **预选验证**：投资组合、交易账户、资产必须在界面预先选择

⚠️ **数据一致性**：所有交易使用相同的投资组合、账户、资产

---

## 十一、快速检查清单

导入前请确认：

- [ ] 已在界面选择投资组合
- [ ] 已在界面选择交易账户
- [ ] 已在界面选择资产
- [ ] 日期格式为 YYYY-MM-DD
- [ ] 交易类型是系统支持的类型
- [ ] 数量 > 0
- [ ] 价格 ≥ 0
- [ ] 币种是3位大写字母
- [ ] 手续费 ≥ 0（如果提供）
- [ ] 标签是数组格式（JSON）或逗号分隔（Excel）

---

## 十二、获取帮助

📖 **详细文档**: `TRANSACTION_IMPORT_FIELDS_SPEC_V2.md`

📝 **实现指南**: `TRANSACTION_IMPORT_IMPLEMENTATION_V2.md`

💡 **设计文档**: `TRANSACTION_IMPORT_EXPORT_DESIGN.md`
